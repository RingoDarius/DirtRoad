(function(g){var window=this;'use strict';var e1t=function(B){var M=new g.Ez("und",new g.AN("Default","und",!0));M.captionTracks=B.captionTracks;return M},o2d=function(B){return new g.kd(function(M,q){var D=B.length,O=[];
if(D)for(var C=function(F,b){D--;O[F]=b;D==0&&M(O)},K=function(F){q(F)},E,v=0;v<B.length;v++)E=B[v],g.R0O(E,g.CY(C,v),K);
else M(O)})},Wg=function(B){this.C=B},Q4=function(){Wg.apply(this,arguments)},E2M=function(){Q4.apply(this,arguments)},v2t=function(){Q4.apply(this,arguments)},Fid=function(){Q4.apply(this,arguments)},bhj=function(){Q4.apply(this,arguments)},uAY=function(){Q4.apply(this,arguments)},Jcu=function(){Q4.apply(this,arguments)},AcZ=function(){Wg.apply(this,arguments)},Nyj=function(){Q4.apply(this,arguments)},z1Y=function(){Q4.apply(this,arguments)},$Lt=function(){Q4.apply(this,arguments)},h1N=function(){Q4.apply(this,
arguments)},ycu=function(){Q4.apply(this,arguments)},Ygd=function(){Q4.apply(this,arguments)},krZ=function(){Q4.apply(this,arguments)},ZhY=function(){Q4.apply(this,arguments)},joL=function(){Q4.apply(this,arguments)},mLu=function(){Q4.apply(this,arguments)},n2o=function(){Q4.apply(this,arguments)},VZL=function(){Q4.apply(this,arguments)},g2d=function(){Wg.apply(this,arguments)},dLL=function(){Q4.apply(this,arguments)},Grj=function(){Q4.apply(this,arguments)},PIt=function(){Q4.apply(this,arguments)},
laT=function(){Q4.apply(this,arguments)},Iau=function(){Q4.apply(this,arguments)},WiZ=function(){Q4.apply(this,arguments)},QoH=function(){Q4.apply(this,arguments)},Hho=function(){Q4.apply(this,arguments)},ULu=function(){Q4.apply(this,arguments)},tZH=function(){Wg.apply(this,arguments)},pft=function(){Wg.apply(this,arguments)},ccZ=function(){Wg.apply(this,arguments)},Sgu=function(){Q4.apply(this,arguments)},faL=function(){Q4.apply(this,arguments)},Tyo=function(){Q4.apply(this,arguments)},LiM=function(){Q4.apply(this,
arguments)},XfT=function(){Q4.apply(this,arguments)},wfu=function(){Q4.apply(this,arguments)},sou=function(){Q4.apply(this,arguments)},R1Z=function(){Q4.apply(this,arguments)},iht=function(){Q4.apply(this,arguments)},rcu=function(){Q4.apply(this,arguments)},xLY=function(){Q4.apply(this,arguments)},aaN=function(){Q4.apply(this,arguments)},B5T=function(){Q4.apply(this,arguments)},M6M=function(){Q4.apply(this,arguments)},qAY=function(){Q4.apply(this,arguments)},DVe=function(){Q4.apply(this,arguments)},
OyZ=function(){Q4.apply(this,arguments)},CVZ=function(){Q4.apply(this,arguments)},Ket=function(){Q4.apply(this,arguments)},eaM=function(){Q4.apply(this,arguments)},odZ=function(){Q4.apply(this,arguments)},EdL=function(){Q4.apply(this,arguments)},vdu=function(){Q4.apply(this,arguments)},FeN=function(){Q4.apply(this,arguments)},byZ=function(){Q4.apply(this,arguments)},uhr=function(){Q4.apply(this,arguments)},JSx=function(){Wg.apply(this,arguments)},ASN=function(){Q4.apply(this,arguments)},N5t=function(){Q4.apply(this,
arguments)},zaL=function(){Q4.apply(this,arguments)},$VH=function(){Q4.apply(this,arguments)},hao=function(){Q4.apply(this,arguments)},ySr=function(){Q4.apply(this,arguments)},YAj=function(){Q4.apply(this,arguments)},kmd=function(){Q4.apply(this,arguments)},ZyT=function(){Q4.apply(this,arguments)},jpL=function(){Q4.apply(this,arguments)},mVT=function(){Q4.apply(this,arguments)},ndH=function(){Q4.apply(this,arguments)},V6x=function(){Q4.apply(this,arguments)},gdY=function(){Q4.apply(this,arguments)},
dVT=function(){Q4.apply(this,arguments)},Gmd=function(){Q4.apply(this,arguments)},PVo=function(){Q4.apply(this,arguments)},lpu=function(){Q4.apply(this,arguments)},Ipt=function(){Q4.apply(this,arguments)},Wej=function(){Q4.apply(this,arguments)},QpM=function(){Q4.apply(this,arguments)},HyM=function(){Q4.apply(this,arguments)},UVt=function(){Q4.apply(this,arguments)},t6t=function(){Q4.apply(this,arguments)},p2d=function(){Q4.apply(this,arguments)},cSu=function(){Q4.apply(this,arguments)},SAj=function(){Q4.apply(this,
arguments)},fpL=function(){Q4.apply(this,arguments)},T5d=function(){Q4.apply(this,arguments)},LeM=function(){Q4.apply(this,arguments)},X2x=function(){Q4.apply(this,arguments)},w2u=function(){Q4.apply(this,arguments)},spM=function(B){B=B.key||B.id;
if(!B)throw Error("Entity key is missing");return B},RaT=function(){if(Hg)return Hg();
var B={};Hg=g.xI("PersistentEntityStoreDb",{LZ:(B.EntityStore={FW:1},B.EntityAssociationStore={FW:2},B),shared:!1,upgrade:function(M,q){q(1)&&g.Ir(g.Vc(M,"EntityStore",{keyPath:"key"}),"entityType","entityType");q(2)&&(M=g.Vc(M,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Ir(M,"byParentEntityKey","parentEntityKey"),g.Ir(M,"byChildEntityKey","childEntityKey"))},
version:3});return Hg()},iye=function(B){return g.Sc(RaT(),B)},rSr=function(B){return g.Sc((0,g.WRN)(),B)},Uu=function(B){this.token=B},ta=function(B,M){M=M===void 0?{}:M;
g.XU.call(this,g.QsT[B],Object.assign({},{name:"PESEncoderError",type:B},M));this.type=B;this.level="WARNING";Object.setPrototypeOf(this,ta.prototype)},xVL=function(B){return new ta("WRONG_DATA_TYPE",{Nf:B})},apN=function(B){return B instanceof Error?new ta("UNKNOWN_ENCODE_ERROR",{originalMessage:B.message}):new ta("UNKNOWN_ENCODE_ERROR")},BQo=function(B){return B instanceof Error?new ta("UNKNOWN_DECODE_ERROR",{originalMessage:B.message}):new ta("UNKNOWN_DECODE_ERROR")},Mre=function(B,M){B=B instanceof
ta?B:M(B);
g.I_(B);throw B;},qee=function(){},Dur=function(B,M,q){try{return B.B(M,q)}catch(D){Mre(D,apN)}},OKY=function(B){B=(new TextEncoder).encode(B).subarray(0,16);
var M=new Uint8Array(16);M.set(B);return M},pS=function(B){this.C=B},K3M=function(B){var M=Chj[B];
if(M)return M;g.W7(new g.XU("Entity model not found.",{entityType:B}))},e$N=function(B,M){this.C=B;
this.T=M;this.B={}},E8u=function(B,M){a:{B=o8N(B.T,M.version);
try{var q=B.T(M.data,M.key);break a}catch(D){Mre(D,BQo)}q=void 0}return q},cg=function(B,M,q){return B.C.objectStore("EntityStore").get(M).then(function(D){if(D){if(q&&D.entityType!==q)throw Error("Incorrect entity type");
return E8u(B,D)}})},SU=function(B,M,q){return q?(q=q.map(function(D){return cg(B,D,M)}),g.kI.all(q)):B.C.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(M)).then(function(D){return D.map(function(O){return E8u(B,O)})})},Tk=function(B,M,q){var D=spM(M),O=o8N(B.T,1),C=Object.assign({},M);
return B.C.objectStore("EntityStore").get(D).then(function(K){if(K){if(K.entityType!==q)throw Error("Incorrect entity type");C.entityMetadata||(K=E8u(B,K),C.entityMetadata=K.entityMetadata)}}).then(function(){var K={key:D,
entityType:q,data:Dur(O,C,D),version:1};return g.kI.all([g.G0(B.C.objectStore("EntityStore"),K),v8Z(B,C,q)])}).then(function(){fS(B,D,q);
return D})},F3u=function(B,M,q){M=M.map(function(D){return Tk(B,D,q)});
return g.kI.all(M)},LS=function(B,M,q){if(q==null?0:q.F3){var D=new Set;
return bKZ(B,M,D).then(function(){for(var C=[],K=g.h(D),E=K.next();!E.done;E=K.next())C.push(LS(B,E.value));return g.kI.all(C).then(function(){})})}var O=g.r8(M).entityType;
return g.kI.all([B.C.objectStore("EntityStore").delete(M),uid(B,M)]).then(function(){fS(B,M,O)})},JBY=function(B,M){return g.Uy(B.C.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(M)},function(q){return g.kI.all([q.delete(),
uid(B,q.cursor.primaryKey)]).then(function(){fS(B,q.cursor.primaryKey,M);return g.Qc(q)})})},ABu=function(B,M,q,D){var O=o8N(B.T,1);
return cg(B,M,D).then(function(C){if(C){C=g.NH(C,q);var K={key:M,entityType:D,data:Dur(O,C,M),version:1};return g.kI.all([g.G0(B.C.objectStore("EntityStore"),K),v8Z(B,C,D)])}}).then(function(){fS(B,M,D);
return M})},fS=function(B,M,q){var D=B.B[q];
D||(D=new Set,B.B[q]=D);D.add(M)},NQL=function(B,M,q){var D=spM(M);
q=K3M(q);if(!q)return g.kI.resolve([]);q=new q(M);B=B.C.objectStore("EntityAssociationStore");M=[];q=g.h(q.T());for(var O=q.next();!O.done;O=q.next())M.push(g.G0(B,{parentEntityKey:D,childEntityKey:O.value}));return g.kI.all(M).then(function(C){return C.map(function(K){return K[1]})})},uid=function(B,M){return B.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(M))},v8Z=function(B,M,q){var D=spM(M);
return uid(B,D).then(function(){return NQL(B,M,q)})},bKZ=function(B,M,q){if(q.has(M))return g.kI.resolve(void 0);
q.add(M);return z$T(B,M).then(function(D){return B.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(M)).then(function(){return D})}).then(function(D){var O=g.kI.resolve(void 0);
D=g.h(D);for(var C=D.next(),K={};!C.done;K={MS:void 0},C=D.next())K.MS=C.value,O=O.then(function(E){return function(){return bKZ(B,E.MS,q)}}(K));
return O}).then(function(){})},z$T=function(B,M){var q=B.C.objectStore("EntityAssociationStore");
return q.index("byParentEntityKey").getAll(IDBKeyRange.only(M)).then(function(D){var O=[];D=g.h(D);for(var C=D.next();!C.done;C=D.next())C=C.value,O.push(q.index("byChildEntityKey").getAll(C.childEntityKey));return g.kI.all(O)}).then(function(D){var O=[];
D=g.h(D);for(var C=D.next();!C.done;C=D.next())C=C.value,C.length===1&&O.push(C[0].childEntityKey);return O})},Xs=function(){},$ur=function(){this.C={};
this.C[0]=new Xs;if(!g.$y("aes_pes_encoder_killswitch")){var B=this.C;try{var M=g.wM();var q=OKY(M);var D=new pS(new g.Z$(q),new g.ke(q))}catch(O){throw B=O instanceof Error?new ta("KEY_CREATION_FAILED",{originalMessage:O.message}):new ta("KEY_CREATION_FAILED"),g.I_(B),B;}B[1]=D}},o8N=function(B,M){M=M===void 0?0:M;
B=B.C[M];if(!B)throw M=new ta("INVALID_ENCODER_VERSION",{Nf:M}),g.I_(M),M;return B},wo=function(B,M){g.H.call(this);
this.token=B;this.C=M;this.observers=[];B=new g.w0.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.wM());B.onmessage=this.T.bind(this);this.channel=B},Re=function(B,M,q){var D,O,C,K;
return g.I(function(E){if(E.C==1)return g.V(E,iye(B.token),2);if(E.C!=3)return D=E.T,g.V(E,g.dj(D,["EntityStore","EntityAssociationStore"],M,function(v){O=new e$N(v,B.C);return q(O)}),3);
C=E.T;O&&(K=O.B,Object.keys(K).length>0&&(B.channel.postMessage(K),h$T(B,K)));return E.return(C)})},iM=function(B,M,q){return Re(B,{mode:"readwrite",
GR:!0},function(D){return Tk(D,M,q)})},yBd=function(B,M){return Re(B,{mode:"readwrite",
GR:!0},function(q){return F3u(q,M,"offlineOrchestrationActionWrapperEntity")})},YeL=function(B,M){return Re(B,{mode:"readwrite",
GR:!0},function(q){return LS(q,M)})},kvH=function(B){return Re(B,{mode:"readwrite",
GR:!0},function(M){return JBY(M,"videoPlaybackPositionEntity")})},ro=function(B,M,q){return Re(B,{mode:"readonly",
GR:!0},function(D){return cg(D,M,q)})},xw=function(B,M,q){return Re(B,{mode:"readonly",
GR:!0},function(D){return SU(D,M,q)})},h$T=function(B,M){B=g.h(B.observers);
for(var q=B.next();!q.done;q=B.next())q=q.value,q(M)},ZKZ=function(){var B,M,q;
return g.I(function(D){if(D.C==1)return g.kZ(D,2),g.V(D,g.iP(),4);if(D.C!=2){B=D.T;if(!B||!g.sY()||typeof g.w0.BroadcastChannel==="undefined")return D.return();M=new $ur;return D.return(new wo(B,M))}q=g.d0(D);q instanceof Error&&g.I_(q);return D.return()})},ae=function(){j7d||(j7d=ZKZ());
return j7d},mut=function(B){var M;
B=(M=B.options)==null?void 0:M.persistenceOption;return B==="ENTITY_PERSISTENCE_OPTION_PERSIST"||B==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},n8u=function(B){var M;
return g.I(function(q){return q.C==1?g.V(q,ae(),2):(M=q.T)?g.V(q,Re(M,"readwrite",function(D){for(var O={},C=g.h(B),K=C.next(),E={};!K.done;E={yc:void 0,FJ:void 0},K=C.next())E.yc=K.value,E.yc.entityKey&&mut(E.yc)&&(E.FJ=g.LY(E.yc.payload),K=void 0,E.yc.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(K=function(v){return function(){return Tk(D,v.yc.payload[v.FJ],v.FJ)}}(E)),E.yc.type==="ENTITY_MUTATION_TYPE_DELETE"&&(K=function(v){return function(){return LS(D,v.yc.entityKey)}}(E)),E.yc.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(K=function(v){return function(){return ABu(D,v.yc.entityKey,v.yc.payload[v.FJ],v.FJ)}}(E)),K&&(O[E.yc.entityKey]=O[E.yc.entityKey]?O[E.yc.entityKey].then(K):K()));
return g.kI.all(Object.values(O))}),0):q.return()})},VrT=function(B){var M;
return g.I(function(q){if(q.C==1){M=B.mutations;if(!M||M.length<=0)return q.return();if(g.qM){var D={type:"ENTITY_LOADED"};M!==void 0&&(D.payload=M);g.qM.dispatch(D)}return g.V(q,n8u(M),2)}M.length=0;g.YZ(q)})},g8M=function(B){return B!==void 0},duN=function(B){var M=g.dE();
M=Object.assign({},M);B=Object.assign({},B);for(var q in M)B[q]?(M[q]!==4&&(M[q]=B[q]),delete B[q]):M[q]!==2&&(M[q]=4);Object.assign(M,B);g.ogZ(M);JSON.stringify(M);return M},GvM=function(B){var M,q;
return g.I(function(D){if(D.C==1)return g.V(D,g.iP(),2);if(D.C!=3)return(M=D.T)?g.V(D,g.lo(M),3):D.return();q=D.T;return D.return(g.dj(q,["index","media","captions"],{mode:"readwrite",GR:!0},function(O){var C=IDBKeyRange.bound(B+"|",B+"~");O=[O.objectStore("index").delete(C),O.objectStore("media").delete(C),O.objectStore("captions").delete(C)];return g.kI.all(O).then(function(){})}))})},Phd=function(){var B,M;
return g.I(function(q){if(q.C==1)return g.V(q,g.iP(),2);if(q.C!=3){B=q.T;if(!B)throw g.yc("rvdfd");return g.V(q,g.lo(B),3)}M=q.T;return q.return(g.dj(M,["index","media"],{mode:"readwrite",GR:!0},function(D){var O={};return g.Ww(D.objectStore("index"),{},function(C){var K=C.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),E=g.kI.resolve(void 0);if(K){var v=K[1];K=K[2];O[v]=O[v]||{};var F;O[v][K]=g.uDg((F=C.getValue())==null?void 0:F.fmts)}else E=C.delete().then(function(){});
return g.kI.all([g.Qc(C),E]).then(function(b){return g.h(b).next().value})}).then(function(){for(var C={},K=g.h(Object.keys(O)),E=K.next();!E.done;E=K.next()){E=E.value;
var v=O[E].v;C[E]=O[E].a&&v?1:2}var F=duN(C);return g.l8Z(D.objectStore("media"),{},function(b){var u=b.cursor.key.match(g.zCC);u&&C[u[1]]||D.objectStore("media").delete(b.cursor.key);return g.Z71(b)}).then(function(){return F})})}))})},lmM=function(B,M){var q,D;
return g.I(function(O){if(O.C==1)return g.V(O,g.iP(),2);if(O.C!=3){q=O.T;if(!q)throw g.yc("wct");return g.V(O,g.lo(q),3)}D=O.T;return g.V(O,g.dj(D,["captions"],{mode:"readwrite",GR:!0},function(C){var K=[];C=C.objectStore("captions");for(var E=0;E<M.length;E++){var v=g.G0(C,M[E],B+"|"+M[E].metadata.vss_id);K.push(v)}return g.kI.all(K)}),0)})},Ime=function(B){var M,q,D;
return g.I(function(O){if(O.C==1)return M=IDBKeyRange.bound(B+"|",B+"~"),g.V(O,g.iP(),2);if(O.C!=3){q=O.T;if(!q)throw g.yc("gactfv");return g.V(O,g.lo(q),3)}D=O.T;return O.return(D.getAll("captions",M))})},W3Z=function(B){return g.I(function(M){g.PX(B,0);
return M.return(GvM(B))})},Q7u=function(B){return{context:g.rA(),
videoIds:B}},HKL=function(B){return{context:g.rA(),
playlistIds:B}},Uur=function(B){return{context:g.rA(),
offlinePlaylistSyncChecks:B}},trt=function(){this.C=new Map},cBe=function(){pcx||(pcx=new trt);
return pcx},Sej=function(B,M){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:B},metadata:M,statusCode:void 0,csn:void 0,can:void 0}},fmN=function(B,M,q){if(!q){var D=D===void 0?!1:D;
q=B.C.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!q||D)q=g.Y9(16),B.C.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",q)}B={flowNonce:q,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:M.eventType};M.metadata&&(B.flowMetadata=M.metadata);M.statusCode!==void 0&&(B.flowEventStatus=M.statusCode);M.csn&&(B.csn=M.csn);M.can&&(B.can=M.can);g.or("flowEvent",B,void 0)},TQH=function(B){var M,q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r,NO,Vr,fZ,mT,bN,g0,mm,Oo,Z,e1,Rt,Zf;
return g.I(function(PZ){if(PZ.C==1)return g.V(PZ,Re(B,{mode:"readonly",GR:!0},function(AL){return SU(AL,"playbackData").then(function(t_){var HZ=t_.map(function(l){return l.transfer}).filter(function(l){return!!l}),lN=t_.map(function(l){return l.offlineVideoPolicy}).filter(function(l){return!!l}),G=t_.filter(function(l){return!!l.key}).map(function(l){return g.x6(g.r8(l.key).entityId,"downloadStatusEntity")});
HZ=SU(AL,"transfer",HZ);lN=SU(AL,"offlineVideoPolicy",lN);G=SU(AL,"downloadStatusEntity",G);var P=HZ.then(function(l){l=l.reduce(function(U,S){(S==null?0:S.offlineVideoStreams)&&U.push.apply(U,g.Y(S.offlineVideoStreams));return U},[]).filter(function(U){return!!U});
return SU(AL,"offlineVideoStreams",l)});
return g.kI.all([HZ,lN,P,G]).then(function(l){var U=g.h(l);l=U.next().value;var S=U.next().value;var Zg=U.next().value;U=U.next().value;return[t_,l,S,Zg,U]})})}),2);
if(PZ.C!=3)return M=PZ.T,g.V(PZ,Re(B,{mode:"readonly",GR:!0},function(AL){return SU(AL,"mainDownloadsListEntity").then(function(t_){var HZ,lN;return(lN=(HZ=t_[0])==null?void 0:HZ.downloads)!=null?lN:[]})}),3);
q=PZ.T;D=g.h(M);O=D.next().value;C=D.next().value;K=D.next().value;E=D.next().value;v=D.next().value;F=O;b=C;u=K;J=E;A=v;N={};y={};k={};m={};n={};d=[];W=g.h(b);for(t=W.next();!t.done;t=W.next())(w=t.value)&&(N[w.key]=w);L=g.h(u);for(qO=L.next();!qO.done;qO=L.next())(Dg=qO.value)&&(y[Dg.key]=Dg);x=g.h(A);for(A_=x.next();!A_.done;A_=x.next())(r=A_.value)&&(k[r.key]=r);NO=g.h(J);for(Vr=NO.next();!Vr.done;Vr=NO.next())(fZ=Vr.value)&&(m[fZ.key]=fZ);mT=g.h(q);for(bN=mT.next();!bN.done;bN=mT.next())g0=bN.value,
mm=void 0,n[(mm=g0.videoItem)!=null?mm:""]=!0,g0.videoItem&&(Z=Oo=void 0,e1=(Z=(Oo=g.r8(g0.videoItem))==null?void 0:Oo.entityId)!=null?Z:"",d.push({externalVideoId:e1}));Rt=F.filter(function(AL){if(!AL||!AL.key||!AL.offlineVideoPolicy)return!1;AL=g.r8(AL.key).entityId;AL=g.x6(AL,"downloadStatusEntity");var t_;return!(AL&&((t_=k[AL])==null?void 0:t_.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Zf=Rt.map(function(AL){var t_=N[AL.transfer],HZ=[];if(t_==null?0:t_.offlineVideoStreams)for(var lN=g.h(t_.offlineVideoStreams),G=lN.next();!G.done;G=lN.next())(G=m[G.value])&&HZ.push(G);lN=y[AL.offlineVideoPolicy];G=n;var P=AL==null?void 0:AL.playerResponseTimestamp,l=g.r8(lN.key).entityId;AL=g.x6(l,"mainVideoEntity");if(lN.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var U="OFFLINE_VIDEO_STATE_DISABLED";lN.expirationTimestamp&&Number(lN.expirationTimestamp)<Date.now()/1E3&&(U="OFFLINE_VIDEO_STATE_EXPIRED")}else if(lN.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")U="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(t_==null?void 0:t_.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":U="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":U="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":U="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":U="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":U="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":U="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:U="OFFLINE_VIDEO_STATE_UNKNOWN"}if(U==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(t_==null?void 0:t_.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":U="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":U="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":U=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}l={id:l,videoState:U};if(t_==null?0:t_.cotn)l.cotn=t_.cotn;if(t_==null?0:t_.maximumDownloadQuality)l.selectedVideoQuality=t_==null?void 0:t_.maximumDownloadQuality;if(t_==null?0:t_.lastProgressTimeMs)l.lastProgressTimeMs=t_.lastProgressTimeMs;P&&(l.playerResponseSavedTimeMs=String(Number(P)*1E3));t_=String;P=0;HZ=g.h(HZ);for(U=HZ.next();!U.done;U=HZ.next())if(U=U.value,U.streamsProgress){U=g.h(U.streamsProgress);for(var S=U.next();!S.done;S=U.next()){var Zg=void 0;
P+=Number((Zg=S.value.numBytesDownloaded)!=null?Zg:0)}}l.downloadedBytes=t_(P);l.selectedOfflineMode=G[AL]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";lN.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(l.offlinePlaybackDisabledReason=lN.offlinePlaybackDisabledReason);return l});
return PZ.return({offlineVideos:Zf,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:d}}})})},L3N=function(){this.locks=navigator.locks},XcH=function(){try{var B=g.Rh("ytglobal.locks_");
if(B)return B;var M;if(M=navigator){var q=navigator;M="locks"in q&&!!q.locks}if(M)return g.w0.localStorage&&g.w0.localStorage.getItem("noop"),B=new L3N,g.sC("ytglobal.locks_",B),B}catch(D){}},Bp=function(){},wct=function(){},s7x=function(B){if(B.includes(":"))throw Error("Invalid user cache name: "+B);
return B+":"+g.wM("CacheStorage get")},R$t=function(){return g.I(function(B){if(MK!==void 0)return B.return(MK);
MK=new Promise(function(M){var q;return g.I(function(D){switch(D.C){case 1:return g.kZ(D,2),g.V(D,qK.open("test-only"),4);case 4:return g.V(D,qK.delete("test-only"),5);case 5:g.nZ(D,3);break;case 2:if(q=g.d0(D),q instanceof Error&&q.name==="SecurityError")return M(!1),D.return();case 3:M("caches"in window),g.YZ(D)}})});
return B.return(MK)})},rBx=function(){return g.I(function(B){if(B.C==1)return g.V(B,R$t(),2);
if(!B.T)return B.return(void 0);iKM||(iKM=new wct);return B.return(iKM)})},DK=function(B,M,q){g.W7(new g.XU("Woffle: "+B,q?{cotn:q}:""));
M instanceof Error&&g.W7(M)},xue=function(B){var M;
return g.I(function(q){if(q.C==1)return g.V(q,TQH(B),2);M=q.T;g.or("offlineStateSnapshot",M);g.YZ(q)})},OV=function(B){g.H.call(this);
var M=this;this.api=B;this.Wc={pXn:function(){return M.C},
AL4:function(){return M.T}};
typeof g.w0.BroadcastChannel!=="undefined"&&(this.C=new g.w0.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.wM()),this.C.onmessage=this.B.bind(this),this.T=new g.w0.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.wM()),this.T.onmessage=this.W.bind(this))},C$=function(B,M){B.api.EC("onOfflineOperationFailure",M);
var q;(q=B.C)==null||q.postMessage(M)},amx=function(B,M,q,D){var O=this;
this.Y=B;this.U=M;this.visibility=q;this.G=D;this.J=this.D=this.K=this.B=this.C=!1;this.W=new g.LP(function(){O.aN()});
this.Wc={cw:function(){return O.T},
aN:function(){O.aN()},
z_R:function(){return O.W}};
this.visibility.subscribe("visibilitystatechange",function(){O.By()})},BzL=function(B){if(!B.B&&!B.C){var M=XcH();
if(M){B.B=!0;var q=g.wM("OfflineLockManager");M.request("woffle_orchestration_leader:"+q,{},function(){var D,O,C,K;return g.I(function(E){switch(E.C){case 1:return g.kZ(E,2),B.T=new g.vc,B.C=!0,B.B=!1,g.V(E,B.Y(),4);case 4:return g.V(E,B.T.promise,5);case 5:g.nZ(E,0);break;case 2:D=g.d0(E),((C=(O=B).G)==null?0:C.call(O,"wo_relinquish_leadership_on_lock_request_error"))||B.aN(),D instanceof Error&&(K=D,K.args=[{name:"WoLockManagerError",v$:D.name}],g.I_(K)),g.YZ(E)}})})}}},MFN=function(B){B.C&&(B.J=
!0,K$(B))},qxr=function(B,M){B.C&&(B.K=M,K$(B))},Dcj=function(B,M){B.C&&(B.D=M,K$(B))},K$=function(B){B.D&&B.K&&B.J&&B.visibility.isBackground()?g.Xk(B.W,6E4):B.W.stop()},e$=function(B){var M;
B.offlineDeleteReason=(M=B.offlineDeleteReason)!=null?M:"OFFLINE_DELETE_REASON_UNKNOWN";var q;B.offlineModeType=(q=B.offlineModeType)!=null?q:"OFFLINE_NOW";g.or("offlineDeleteEvent",B)},oc=function(B,M){var q=M.videoId;
var D=M.o$;M=M.offlineModeType;B.encryptedVideoId=q;B.cotn=D==null?void 0:D.cotn;B.offlineabilityFormatType=D==null?void 0:D.maximumDownloadQuality;var O;B.isRefresh=(O=D==null?void 0:D.isRefresh)!=null?O:!1;var C;B.softErrorCount=(C=D==null?void 0:D.transferRetryCount)!=null?C:0;B.offlineModeType=M!=null?M:"OFFLINE_NOW";(B.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&B.statusType==="UNKNOWN_STATUS_TYPE"||!B.transferStatusType&&!B.statusType)&&g.W7(Error("Woffle unknown transfer status"));
g.or("offlineTransferStatusChanged",B)},OPu=function(B){oc({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},B)},CxH=function(B,M,q,D){D={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!D};M&&q&&(M=Math.floor(M/1024).toFixed(),q=Math.floor(q/1024).toFixed(),D.alreadyDownloadedKbytes=M,D.totalFetchedKbytes=M,D.totalContentKbytes=q);oc(D,B)},Kru=function(B){oc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},B)},e6e=function(B){oc({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},B)},osL=function(B){switch(B){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
EV=function(B){var M,q,D;
return((D=(M=B.actionMetadata)==null?void 0:(q=M.retryScheduleIntervalsInSeconds)==null?void 0:q.length)!=null?D:0)>0},vp=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!B.entityKey},FY=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!B.entityKey},bD=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!B.entityKey},EsZ=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!B.entityKey},
uD=function(B,M,q,D,O){O=O===void 0?!1:O;
var C,K,E,v,F,b;return g.I(function(u){if(u.C==1)return C=g.x6(B,M),K=g.x6(B,"downloadStatusEntity"),g.V(u,Re(q,{mode:"readonly",GR:!0},function(J){return g.kI.all([cg(J,C,M),cg(J,K,"downloadStatusEntity")])}),2);
E=u.T;v=E.length?E[0]:void 0;if(!v)return u.ZX(0);F=vsd;if(b=E.length>1?E[1]:void 0){if(b.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!O)return u.return();b.downloadState=D}else b={key:K,downloadState:D};g.pE(v,F,b);return g.V(u,Re(q,{mode:"readwrite",GR:!0},function(J){return g.kI.all([Tk(J,v,M),Tk(J,b,"downloadStatusEntity")])}),0)})},Ju=function(B,M){return B.actionType===M.actionType&&B.entityKey===M.entityKey},Au=function(B,M){if(B&&B.transferState!=="TRANSFER_STATE_COMPLETE"&&B.transferState!==
"TRANSFER_STATE_FAILED"){var q=g.r8(B.key).entityId;
oc({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:q,o$:B,offlineModeType:M})}},NK=function(B){if(!B||!B.thumbnails)return[];
var M=[];B=g.h(B.thumbnails);for(var q=B.next();!q.done;q=B.next())q=q.value,q.url&&M.push(q.url);return M},FrH=function(B,M,q){q=q===void 0?[]:q;
var D,O,C,K,E,v,F,b,u,J,A,N,y;return g.I(function(k){if(k.C==1)return q.length?g.V(k,xw(B,M),2):k.return([]);D=k.T;O=new Set;C=g.h(D);for(K=C.next();!K.done;K=C.next())if(E=K.value,v=E.id||E.key)F=g.r8(v).entityId,O.add(F);b=[];u=g.h(q);for(J=u.next();!J.done;J=u.next())A=J.value,N=A.offlineVideoData,y=void 0,((y=N)==null?0:y.videoId)&&!O.has(N.videoId)&&b.push(A);return k.return(b)})},bPT=function(B,M,q){return new g.LV(B,{cotn:M,
raw_player_response:q,download_media:!0,start:Infinity,disable_watch_next:!0})},ukr=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},zM=function(B,M,q,D,O,C,K,E,v,F,b){this.entityType=B;
this.actionId=M;this.action=q;this.parentActionId=D;this.rootActionId=O===void 0?M:O;this.childActionIds=C;this.prereqActionId=K;this.postreqActionIds=E;this.hasChildActionFailed=F;this.retryScheduleIndex=0;this.C=b||Date.now();this.retryScheduleIndex=v||0},$B=function(B){if(!B.key)throw Error("Entity key is required.");
if(!B.actionProto)throw Error("OfflineOrchestrationAction is required.");var M=g.r8(B.key),q=g.r8(B.actionProto.entityKey);return new zM(q.entityType,M.entityId,B.actionProto,B.parentActionId,B.rootActionId,B.childActionIds,B.prereqActionId,B.postreqActionIds,B.retryScheduleIndex,B.hasChildActionFailed,Number(B.enqueueTimeSec)*1E3)},hu=function(B){return{key:g.x6(B.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:B.action,parentActionId:B.parentActionId,rootActionId:B.rootActionId,childActionIds:B.childActionIds,prereqActionId:B.prereqActionId,postreqActionIds:B.postreqActionIds,retryScheduleIndex:B.retryScheduleIndex,hasChildActionFailed:B.hasChildActionFailed,enqueueTimeSec:(B.C/1E3).toFixed()}},J2o=function(){var B;
return g.I(function(M){return M.C==1?g.V(M,rBx(),2):(B=M.T)?M.return(B.delete("yt-player-local-img")):M.return(!0)})},yQ=function(B){var M,q;
return g.I(function(D){if(D.C==1)return g.V(D,rBx(),2);if(D.C!=3){M=D.T;if(!M)throw Error("Cache API not supported");return B.length?g.V(D,M.open("yt-player-local-img"),3):D.return()}q=D.T;return g.V(D,Promise.all(B.map(function(O){return q.delete(O)})),0)})},YB=function(B){var M,q;
return g.I(function(D){if(D.C==1)return g.V(D,rBx(),2);if(D.C!=3){M=D.T;if(!M)throw Error("Cache API not supported");return B.length?g.V(D,M.open("yt-player-local-img"),3):D.return()}q=D.T;return g.V(D,q.addAll(B),0)})},kB=function(B,M,q,D,O){var C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r,NO,Vr,fZ,mT,bN,g0,mm;
return g.I(function(Oo){switch(Oo.C){case 1:return C=g.x6(B,"mainVideoEntity"),K=g.x6(B,"ytMainChannelEntity"),E=g.x6(B,"transfer"),v=g.x6(B,"videoDownloadContextEntity"),g.V(Oo,Re(M,{mode:"readonly",GR:!0},function(Z){return g.kI.all([cg(Z,C,"mainVideoEntity"),cg(Z,K,"ytMainChannelEntity"),cg(Z,E,"transfer"),cg(Z,v,"videoDownloadContextEntity"),SU(Z,"ytMainChannelEntity"),SU(Z,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:F=Oo.T;b=g.h(F);u=b.next().value;J=b.next().value;A=b.next().value;N=b.next().value;y=b.next().value;k=b.next().value;m=u;n=J;d=A;W=N;t=y;w=k;if(!m&&!n){Oo.ZX(3);break}L=m?NK(m.thumbnail):[];if(!n){qO=[];Oo.ZX(4);break}return g.V(Oo,A2x(n,t),5);case 5:qO=Oo.T;case 4:return Dg=qO,g.V(Oo,yQ(L.concat(Dg)),3);case 3:x=[];A_=g.x6(B,"downloadStatusEntity");r=g.h(w);for(NO=r.next();!NO.done;NO=r.next())Vr=NO.value,fZ=g.r8(Vr.key).entityId,mT=$B(Vr),bN=g.r8(mT.action.entityKey).entityId,fZ!==B&&bN!==
B||Ju(q,Vr.actionProto)||x.push(Vr.key);return g.V(Oo,Re(M,{mode:"readwrite",GR:!0},function(Z){var e1=x.map(function(Rt){return LS(Z,Rt)});
e1.push(LS(Z,C,{F3:!0}));e1.push(LS(Z,A_,{F3:!0}));return g.kI.all(e1)}),7);
case 7:mm=(g0=W)==null?void 0:g0.offlineModeType,O&&(e$(O),O.offlineModeType&&(mm=O.offlineModeType)),Au(d,mm),C$(D,{entityKey:C,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.YZ(Oo)}})},$cN=function(B,M,q,D){var O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r,NO,Vr,fZ,mT,bN,g0,mm,Oo,Z,e1,Rt,Zf,PZ,AL,t_,HZ,lN,G,P,l,U,S,Zg,MO,$Z;
return g.I(function(OC){switch(OC.C){case 1:return O=g.x6(B,"mainPlaylistEntity"),C=g.x6(B,"ytMainChannelEntity"),g.V(OC,Re(M,{mode:"readonly",GR:!0},function(GK){return g.kI.all([cg(GK,O,"mainPlaylistEntity"),cg(GK,C,"ytMainChannelEntity"),SU(GK,"mainPlaylistEntity"),SU(GK,"mainDownloadsListEntity"),SU(GK,"ytMainChannelEntity"),SU(GK,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:K=OC.T;E=g.h(K);v=E.next().value;F=E.next().value;b=E.next().value;u=E.next().value;J=E.next().value;A=E.next().value;N=v;y=F;k=b;m=u;n=J;d=A;if(!N&&!y){OC.ZX(3);break}W=N?Nzx(N):[];if(!y){t=[];OC.ZX(4);break}return g.V(OC,A2x(y,n),5);case 5:t=OC.T;case 4:return w=t,g.V(OC,yQ(W.concat(w)),3);case 3:L=[];qO=new Map;if(!N){OC.ZX(7);break}return g.V(OC,z6o(N,k,m),8);case 8:L=OC.T;Dg=g.h(L);for(x=Dg.next();!x.done;x=Dg.next())A_=x.value,qO.set(A_,{videoId:A_,playlistId:B,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.V(OC,Re(M,{mode:"readonly",GR:!0},function(GK){return g.kI.all([SU(GK,"transfer"),SU(GK,"videoDownloadContextEntity")])}),9);
case 9:r=OC.T;NO=g.h(r);Vr=NO.next().value;fZ=NO.next().value;mT=Vr;bN=fZ;g0=g.h(mT);for(mm=g0.next();!mm.done;mm=g0.next())Oo=mm.value,Z=g.r8(Oo.key).entityId,(e1=qO.get(Z))&&Oo&&(e1.cotn=Oo.cotn);Rt=g.h(bN);for(Zf=Rt.next();!Zf.done;Zf=Rt.next())PZ=Zf.value,AL=g.r8(PZ.key).entityId,(t_=qO.get(AL))&&PZ&&(t_.offlineModeType=PZ.offlineModeType);case 7:HZ=[];lN=g.h(d);for(G=lN.next();!G.done;G=lN.next())P=G.value,l=g.r8(P.key).entityId,U=$B(P),l!==B&&U.rootActionId!==B||Ju(q,P.actionProto)||HZ.push(P.key);
S=g.x6(B,"mainPlaylistEntity");return g.V(OC,Re(M,{mode:"readwrite",GR:!0},function(GK){var r0=HZ.map(function(Zj){return LS(GK,Zj)});
r0.push(LS(GK,S,{F3:!0}));return g.kI.all(r0)}),10);
case 10:if(!N){OC.ZX(0);break}L.reverse();if(!L){OC.ZX(0);break}Zg=g.h(L);MO=Zg.next();case 13:if(MO.done){OC.ZX(0);break}$Z=MO.value;return g.V(OC,kB($Z,M,q,D,qO.get($Z)),14);case 14:MO=Zg.next(),OC.ZX(13)}})},y2u=function(B,M,q,D){var O,C,K,E,v,F,b,u,J;
return g.I(function(A){if(A.C==1)return O=g.x6("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),C=new Map,g.V(A,Re(B,{mode:"readwrite",GR:!0},function(N){var y=SU(N,"transfer"),k=SU(N,"offlineOrchestrationActionWrapperEntity"),m=SU(N,"videoDownloadContextEntity"),n=cg(N,O,"mainDownloadsListEntity");return g.kI.all([y,k,m,n]).then(function(d){d=g.h(d);var W=d.next().value;var t=d.next().value;var w=d.next().value;var L=d.next().value;d=h6N.map(function(Dg){return JBY(N,Dg)});
t=g.h(t);for(var qO=t.next();!qO.done;qO=t.next())qO=qO.value,Ju(M,qO.actionProto)||d.push(LS(N,qO.key,{F3:!0}));L&&(L.downloads=[],d.push(Tk(N,L,"mainDownloadsListEntity")));if(w)for(w=g.h(w),L=w.next();!L.done;L=w.next())L=L.value,t=g.r8(L.key).entityId,t=g.x6(t,"transfer"),C.set(t,L.offlineModeType);return g.kI.all(d).then(function(){return W})})}),2);
K=A.T;E=g.h(K);for(v=E.next();!v.done;v=E.next())F=v.value,Au(F,C.get(F.key)),b=g.r8(F.key).entityId,u={videoId:b,offlineDeleteReason:D,cotn:F.cotn,offlineModeType:C.get(F.key)},e$(u),J=g.x6(b,"mainVideoEntity"),C$(q,{entityKey:J,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.V(A,J2o(),0)})},Nzx=function(B,M){var q=[];
if(B.thumbnailStyleData){B=g.h(B.thumbnailStyleData);for(var D=B.next();!D.done;D=B.next()){var O=void 0,C=void 0,K=void 0;q=q.concat(NK((O=D.value)==null?void 0:(C=O.value)==null?void 0:(K=C.collageThumbnail)==null?void 0:K.coverThumbnail))}}M=NK(M);return q.concat(M)},z6o=function(B,M,q){var D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg;
return g.I(function(x){D=[];O=new Set;if(q.length)for(C=g.h(q),K=C.next();!K.done;K=C.next())if(E=K.value,v=void 0,(v=E.downloads)==null?0:v.length)for(F=g.h(E.downloads),b=F.next();!b.done;b=F.next())u=b.value,u.videoItem&&(J=g.r8(u.videoItem).entityId,O.add(J));if(B.videos){A=g.h(B.videos);for(N=A.next();!N.done;N=A.next())y=N.value,k=JSON.parse(g.r8(y).entityId),k.videoId&&!O.has(k.videoId)&&D.push(k.videoId);m=g.h(M);for(n=m.next();!n.done;n=m.next())if(d=n.value,d.key!==B.key&&(W=d.videos))for(t=
g.h(W),w=t.next();!w.done;w=t.next())L=w.value,qO=JSON.parse(g.r8(L).entityId),qO.videoId&&(Dg=D.indexOf(qO.videoId),Dg!==-1&&D.splice(Dg,1))}return x.return(D)})},A2x=function(B,M){var q,D,O,C,K,E,v,F;
return g.I(function(b){q=NK(B.avatar);D=g.h(M);for(O=D.next();!O.done;O=D.next())if(C=O.value,C.id!==B.id)for(K=g.h(NK(C.avatar)),E=K.next();!E.done;E=K.next())v=E.value,F=q.indexOf(v),F!==-1&&q.splice(F,1);return b.return(q)})},Yxx=function(B){var M;
return g.I(function(q){M=g.c(B.frameworkUpdates,ZK);return B.frameworkUpdates&&M?g.V(q,VrT(M),0):q.return()})},ZPd=function(B){var M;
if((M=B.onResponseReceivedActions)!=null&&M.length){var q;B=(q=g.c(g.c(B.onResponseReceivedActions[0],k$u),g.Gte))==null?void 0:q.actions;if(B!=null&&B.length)return B}},jbu=function(B){var M,q,D;
return g.I(function(O){if(O.C==1)return B?g.V(O,ro(B,g.Gi,"mainDownloadsListEntity"),2):O.return([]);M=O.T;return((q=M)==null?0:(D=q.downloads)==null?0:D.length)?O.return(M.downloads.map(function(C){var K;return(K=C.videoItem)!=null?K:""})):O.return([])})},nsu=function(B,M){var q;
return g.I(function(D){return D.C==1?g.V(D,mcx(B,M),2):(q=D.T)?g.V(D,Re(B,{mode:"readwrite",GR:!0},function(O){var C=[Tk(O,q.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];q.mainDownloadsListEntity&&C.push(Tk(O,q.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.kI.all(C)}),0):D.ZX(0)})},mcx=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d;
return g.I(function(W){if(W.C==1)return q=g.x6("main_downloads_library_id","mainDownloadsLibraryEntity"),D=g.x6("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.V(W,Re(B,{mode:"readonly",GR:!0},function(t){return g.kI.all([cg(t,q,"mainDownloadsLibraryEntity"),cg(t,D,"mainDownloadsListEntity")])}),2);
O=W.T;C=g.h(O);K=C.next().value;E=C.next().value;v=K;F=E;v||(v={id:q});b=g.h(M);for(u=b.next();!u.done;u=b.next())if(J=u.value,J===g.Gi){if(v.smartDownloadsList)return W.return();v.smartDownloadsList=J}else if(A=g.r8(J).entityType,N={},A==="mainPlaylistEntity"?N.playlistItem=J:A==="mainVideoEntity"&&(N.videoItem=J),!g.xu(N)){y=void 0;if((y=F)==null?0:y.downloads){k=!1;m=g.h(F.downloads);for(n=m.next();!n.done;n=m.next())if(d=n.value,d.playlistItem===J||d.videoItem===J){k=!0;break}k||F.downloads.push(N)}else F=
{id:D,downloads:[N]};v.downloadsList=D}return W.return({mainDownloadsLibraryEntity:v,mainDownloadsListEntity:F})})},VFT=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k;
return g.I(function(m){if(m.C==1)return q=g.x6("main_downloads_library_id","mainDownloadsLibraryEntity"),D=g.x6("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.V(m,Re(B,{mode:"readonly",GR:!0},function(n){return g.kI.all([cg(n,q,"mainDownloadsLibraryEntity"),cg(n,D,"mainDownloadsListEntity"),cg(n,g.Gi,"mainDownloadsListEntity")])}),2);
O=m.T;C=g.h(O);K=C.next().value;E=C.next().value;v=C.next().value;F=K;b=E;u=v;if(!F)return m.ZX(0);if(M===g.Gi&&((J=u)==null?0:J.downloads))u.downloads=[];else if((A=b)==null?0:A.downloads)for(N=g.r8(M).entityType,y=0;y<b.downloads.length;y++)if(k=b.downloads[y],N==="mainVideoEntity"&&k.videoItem===M){b.downloads.splice(y,1);break}else if(N==="mainPlaylistEntity"&&k.playlistItem===M){b.downloads.splice(y,1);break}return g.V(m,Re(B,{mode:"readwrite",GR:!0},function(n){var d=[Tk(n,F,"mainDownloadsLibraryEntity")];
b&&d.push(Tk(n,b,"mainDownloadsListEntity"));u&&d.push(Tk(n,u,"mainDownloadsListEntity"));return g.kI.all(d)}),0)})},j$=function(B,M){var q,D,O,C,K,E,v,F,b,u,J;
return g.I(function(A){if(A.C==1)return q=g.x6(M,"transfer"),D=g.x6(M,"videoDownloadContextEntity"),g.V(A,Re(B,{mode:"readonly",GR:!0},function(N){return g.kI.all([cg(N,q,"transfer"),cg(N,D,"videoDownloadContextEntity")])}),2);
O=A.T;C=g.h(O);K=C.next().value;E=C.next().value;v=K;F=E;J={videoId:M,cotn:(b=v)==null?void 0:b.cotn,offlineModeType:(u=F)==null?void 0:u.offlineModeType};return A.return(J)})},mu=function(B,M,q,D,O){var C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO;
return g.I(function(Dg){switch(Dg.C){case 1:return C=g.x6(B,"musicTrack"),K=g.x6(B,"transfer"),g.V(Dg,Re(M,{mode:"readonly",GR:!0},function(x){return g.kI.all([cg(x,C,"musicTrack"),cg(x,K,"transfer"),SU(x,"musicTrack"),SU(x,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=Dg.T;v=g.h(E);F=v.next().value;b=v.next().value;u=v.next().value;J=v.next().value;A=F;N=b;y=u;k=J;if(!A){Dg.ZX(3);break}return g.V(Dg,gsT(A,y),4);case 4:return m=Dg.T,g.V(Dg,yQ(m),3);case 3:n=[];d=g.h(k);for(W=d.next();!W.done;W=d.next())t=W.value,w=g.r8(t.key).entityId,L=$B(t),qO=g.r8(L.action.entityKey).entityId,w!==B&&qO!==B||Ju(q,t.actionProto)||n.push(t.key);return g.V(Dg,Re(M,{mode:"readwrite",GR:!0},function(x){var A_=n.map(function(r){return LS(x,r)});
A_.push(LS(x,C,{F3:!0}));return g.kI.all(A_)}),6);
case 6:Au(N),O&&e$(O),C$(D,{entityKey:C,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.YZ(Dg)}})},n$=function(B,M,q,D,O){var C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r,NO,Vr,fZ,mT,bN,g0,mm,Oo,Z,e1,Rt,Zf;
return g.I(function(PZ){switch(PZ.C){case 1:return C=g.x6(B,M),K=g.x6("music_downloads_library_id","musicDownloadsLibraryEntity"),g.V(PZ,Re(q,{mode:"readonly",GR:!0},function(AL){return g.kI.all([cg(AL,C,M),cg(AL,K,"musicDownloadsLibraryEntity"),SU(AL,M),SU(AL,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=PZ.T;v=g.h(E);F=v.next().value;b=v.next().value;u=v.next().value;J=v.next().value;A=F;N=b;y=u;k=J;if(!A){PZ.ZX(3);break}return g.V(PZ,gsT(A,y),4);case 4:return m=PZ.T,g.V(PZ,yQ(m),3);case 3:n=[];d=new Map;if(!A){PZ.ZX(6);break}return g.V(PZ,dcY(A,y,N),7);case 7:n=PZ.T;W=g.h(n);for(t=W.next();!t.done;t=W.next())w=t.value,L=g.r8(w).entityId,d.set(L,{videoId:L,playlistId:B,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.V(PZ,xw(q,"transfer"),8);case 8:for(qO=PZ.T,Dg=
g.h(qO),x=Dg.next();!x.done;x=Dg.next())A_=x.value,r=g.r8(A_.key).entityId,(NO=d.get(r))&&A_&&(NO.cotn=A_.cotn);case 6:Vr=[];fZ=g.h(k);for(mT=fZ.next();!mT.done;mT=fZ.next())bN=mT.value,g0=g.r8(bN.key).entityId,mm=$B(bN),g0!==B&&mm.rootActionId!==B||Ju(D,bN.actionProto)||Vr.push(bN.key);Oo=g.x6(B,M);return g.V(PZ,Re(q,{mode:"readwrite",GR:!0},function(AL){var t_=Vr.map(function(HZ){return LS(AL,HZ)});
t_.push(LS(AL,Oo,{F3:!0}));return g.kI.all(t_)}),9);
case 9:if(!A){PZ.ZX(0);break}n.reverse();if(!n.length){PZ.ZX(0);break}Z=g.h(n);e1=Z.next();case 12:if(e1.done){PZ.ZX(0);break}Rt=e1.value;Zf=g.r8(Rt).entityId;if(!Zf){PZ.ZX(13);break}return g.V(PZ,mu(Zf,q,D,O,d.get(Zf)),13);case 13:e1=Z.next(),PZ.ZX(12)}})},VQ=function(B,M,q){var D,O,C,K,E,v,F;
return g.I(function(b){if(b.C==1)return g.V(b,Re(B,{mode:"readwrite",GR:!0},function(u){var J=SU(u,"transfer"),A=SU(u,"offlineOrchestrationActionWrapperEntity");return g.kI.all([J,A]).then(function(N){N=g.h(N);var y=N.next().value;var k=N.next().value;N=G$d.map(function(W){return JBY(u,W)});
k=g.h(k);for(var m=k.next();!m.done;m=k.next()){m=m.value;var n=g.r8(m.actionProto.entityKey).entityType==="musicTrack",d=m.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Ju(M,m.actionProto)||n&&(!n||d)||N.push(LS(u,m.key,{F3:!0}))}return g.kI.all(N).then(function(){return y})})}),2);
D=b.T;O=g.h(D);for(C=O.next();!C.done;C=O.next())K=C.value,Au(K),E=g.r8(K.key).entityId,v={videoId:E,offlineDeleteReason:void 0,cotn:K.cotn},e$(v),F=g.x6(E,"musicTrack"),C$(q,{entityKey:F,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.V(b,J2o(),0)})},PxT=function(B){for(var M,q=g.h(B.additionalMetadatas),D=q.next();!D.done;D=q.next())D=D.value,D.offlineMusicVideoData&&(M=D.offlineMusicVideoData);
var O,C,K,E,v;return{id:g.x6(B.videoId,"musicTrack"),videoId:B.videoId,title:B.title,thumbnailDetails:B.thumbnail,lengthMs:String(Number(B.lengthSeconds)*1E3),albumTitle:(O=M)==null?void 0:O.releaseTitle,musicVideoType:(C=M)==null?void 0:C.musicVideoType,contentRating:{explicitType:(K=M)==null?void 0:K.explicitType},artistNames:((E=M)==null?void 0:E.byline)||((v=M)==null?void 0:v.channelName),downloadMetadata:g.x6(B.videoId,"musicTrackDownloadMetadataEntity")}},dcY=function(B,M,q){var D,O,C,K,E,v,
F,b,u,J,A,N,y,k,m,n,d,W;
return g.I(function(t){D=[];O=new Set;if((C=q)==null?0:(K=C.downloadedTracks)==null?0:K.length)for(E=g.h(q.downloadedTracks),v=E.next();!v.done;v=E.next())F=v.value,O.add(F);if(B.tracks){b=g.h(B.tracks);for(u=b.next();!u.done;u=b.next())J=u.value,O.has(J)||D.push(J);A=g.h(M);for(N=A.next();!N.done;N=A.next())if(y=N.value,y.id!==B.id&&(k=y.tracks))for(m=g.h(k),n=m.next();!n.done;n=m.next())d=n.value,W=D.indexOf(d),W!==-1&&D.splice(W,1)}return t.return(D)})},gsT=function(B,M){var q,D,O,C,K,E,v,F;
return g.I(function(b){q=NK(B.thumbnailDetails);D=g.h(M);for(O=D.next();!O.done;O=D.next())if(C=O.value,C.id!==B.id)for(K=g.h(NK(C.thumbnailDetails)),E=K.next();!E.done;E=K.next())v=E.value,F=q.indexOf(v),F!==-1&&q.splice(F,1);return b.return(q)})},l0r=function(B,M){var q,D,O,C,K,E,v,F,b;
return g.I(function(u){if(u.C==1)return q=g.x6("music_downloads_library_id","musicDownloadsLibraryEntity"),g.V(u,ro(B,q,"musicDownloadsLibraryEntity"),2);(D=u.T)||(D={id:q});O=g.r8(M).entityType;O==="musicTrack"?(C=D.downloadedTracks)!=null&&C.includes(M)||(D.downloadedTracks=((K=D.downloadedTracks)!=null?K:[]).concat(M)):O==="musicPlaylist"?(E=D.downloadedPlaylists)!=null&&E.includes(M)||(D.downloadedPlaylists=((v=D.downloadedPlaylists)!=null?v:[]).concat(M)):O!=="musicAlbumRelease"||(F=D.downloadedAlbumReleases)!=
null&&F.includes(M)||(D.downloadedAlbumReleases=((b=D.downloadedAlbumReleases)!=null?b:[]).concat(M));return g.V(u,iM(B,D,"musicDownloadsLibraryEntity"),0)})},I0M=function(B,M){var q,D,O,C,K,E,v;
return g.I(function(F){if(F.C==1)return q=g.x6("music_downloads_library_id","musicDownloadsLibraryEntity"),g.V(F,ro(B,q,"musicDownloadsLibraryEntity"),2);D=F.T;if(!D)return F.ZX(0);O=g.r8(M).entityType;O==="musicTrack"?C=D.downloadedTracks:O==="musicPlaylist"&&(C=D.downloadedPlaylists);if((K=C)==null?0:K.length)for(E=0;E<C.length;E++)if(v=C[E],v===M){C.splice(E,1);break}return g.V(F,iM(B,D,"musicDownloadsLibraryEntity"),0)})},Wrr=function(B){var M=B.videos;
B=[];var q=[];if(M){M=g.h(M);for(var D=M.next();!D.done;D=M.next()){var O=D.value.offlineVideoData.videoId;D=g.x6(O,"musicTrack");O=g.x6(O,"musicTrackDownloadMetadataEntity");B.push(D);q.push(O)}}return{BR:B,T$:q}},g3=function(B,M,q){M={track:PxT(M)};
q&&(M.playlistId=q);if(B=g.c(B.actionMetadata,Qbo))M.maximumDownloadQuality=B.maximumDownloadQuality;return{musicTrackEntityActionMetadata:M}},UcL=function(B){var M,q,D,O,C,K,E,v;
return g.I(function(F){switch(F.C){case 1:return M=g.C0(),q=Q7u(B),D=g.B0(HPu),g.kZ(F,2),C={T8:!0},g.V(F,g.sD(M,q,D,void 0,C),4);case 4:O=F.T;g.nZ(F,3);break;case 2:K=g.d0(F);if(K instanceof g.qH)throw E="GetOffline network manager error: "+K.message,DK(E,K),Error(E);DK("GetOffline fetch request error",K);throw Error("GetOffline fetch request error");case 3:v=d3(O);if(!O)throw DK("Network request failed"),Error("Network request failed");if(v!==void 0)GM(v);else if(!O.videos||!O.videos.length)throw DK("No data"),
Error("No data");return F.return(O.videos.map(function(b){return b.offlineVideoData}))}})},tFN=function(B){var M,q,D,O,C,K,E,v;
return g.I(function(F){switch(F.C){case 1:return M=g.C0(),q=HKL(B),D=g.B0(HPu),g.kZ(F,2),C={T8:!0},g.V(F,g.sD(M,q,D,void 0,C),4);case 4:O=F.T;g.nZ(F,3);break;case 2:K=g.d0(F);if(K instanceof g.qH)throw E="GetOffline network manager error for playlist: "+K.message,DK(E,K),Error(E);DK("GetOffline fetch request error for playlist",K);throw Error("GetOffline fetch request error for playlist");case 3:v=d3(O);if(!O)throw DK("Network request failed for playlist"),Error("Network request failed for playlist");
if(v!==void 0)GM(v,"playlist");else if(!O.playlists||!O.playlists.length)throw DK("No data for playlist"),Error("No data for playlist");return F.return(O.playlists.map(function(b){return b.offlinePlaylistData}))}})},c2M=function(B,M,q,D){var O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r,NO,Vr,fZ,mT,bN;
return g.I(function(g0){switch(g0.C){case 1:return g.V(g0,ae(),2);case 2:O=g0.T;if(!O)return g0.return([]);C=[];if((K=D)==null?0:K.length){C=D;g0.ZX(3);break}return g.V(g0,xw(O,"mainPlaylistEntity"),4);case 4:C=g0.T;case 3:if(!C.length)return g0.return([]);E=[];v=Date.now()/1E3;F=g.h(C);b=F.next();case 5:if(b.done)return E.length?g.V(g0,pMN(E),10):g0.return([]);u=b.value;if(!u.downloadState){J=void 0;g0.ZX(8);break}return g.V(g0,ro(O,u.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:J=
g0.T;case 8:A=J;N=void 0;k=(y=(N=u)==null?void 0:N.entityMetadata)&&y.nextAutoRefreshIntervalSeconds?Number(y.nextAutoRefreshIntervalSeconds):NaN;m=Number.isNaN(k)?B:k;d=n=void 0;W=((n=A)==null?0:n.lastSyncedTimestampMillis)?Number((d=A)==null?void 0:d.lastSyncedTimestampMillis)/1E3:0;w=t=void 0;L=((t=A)==null?0:t.addedTimestampMillis)?Number((w=A)==null?void 0:w.addedTimestampMillis)/1E3:0;if(q||!y||W+m<=v){qO=[];Dg=void 0;if((Dg=u.videos)==null?0:Dg.length)for(x=g.h(u.videos),A_=x.next();!A_.done;A_=
x.next())r=A_.value,NO=JSON.parse(g.r8(r).entityId),NO.videoId&&qO.push(NO.videoId);Vr="0";y&&(fZ=void 0,Vr=String(Number((fZ=y.offlineLastModifiedTimestampSeconds)!=null?fZ:0).toFixed()));mT={playlistId:u.playlistId,videoIds:qO,offlineLastModifiedTimestamp:Vr,autoSync:M,offlineDateAddedTimestamp:String(L.toFixed())};E.push(mT)}b=F.next();g0.ZX(5);break;case 10:return bN=g0.T,g0.return(bN)}})},Sxe=function(){var B,M,q,D,O;
return g.I(function(C){if(C.C==1)return g.V(C,ae(),2);if(C.C!=3)return(B=C.T)?g.V(C,xw(B,"refresh"),3):C.return(!1);M=C.T;if((q=M[0])==null||!q.refreshTime)return C.return(!1);D=Number(M[0].refreshTime);O=Date.now()/1E3;return C.return(isFinite(D)&&O>=D)})},Tzx=function(B,M){var q,D,O;
return g.I(function(C){switch(C.C){case 1:return g.kZ(C,2),g.V(C,f0H(B,M),4);case 4:return D=C.T,g.V(C,Yxx(D),5);case 5:q=ZPd(D);g.nZ(C,3);break;case 2:O=g.d0(C),DK("getAndProcessSmartDownloadsResponse request or processing error",O);case 3:return C.return(q)}})},Lrj=function(B,M,q,D){var O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r,NO,Vr,fZ,mT,bN;
return g.I(function(g0){switch(g0.C){case 1:return g.V(g0,ae(),2);case 2:O=g0.T;if(!O)return g0.return([]);C=[];if((K=D)==null?0:K.length){C=D;g0.ZX(3);break}return g.V(g0,xw(O,"musicPlaylist"),4);case 4:C=g0.T;case 3:if(!C.length)return g0.return([]);E=[];v=Date.now()/1E3;F=g.h(C);b=F.next();case 5:if(b.done)return E.length?g.V(g0,pMN(E),10):g0.return([]);u=b.value;J=void 0;N=(A=(J=u)==null?void 0:J.entityMetadata)&&A.nextAutoRefreshIntervalSeconds?Number(A.nextAutoRefreshIntervalSeconds):NaN;y=
Number.isNaN(N)?B:N;m=k=0;n="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!u.downloadMetadata){g0.ZX(8);break}return g.V(g0,ro(O,u.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:d=g0.T,t=W=void 0,k=Number((t=(W=d)==null?void 0:W.addedTimestampMillis)!=null?t:"0")/1E3,L=w=void 0,m=Number((L=(w=d)==null?void 0:w.lastModifiedTimestampMillis)!=null?L:"0")/1E3,Dg=qO=void 0,n=(Dg=(qO=d)==null?void 0:qO.syncState)!=null?Dg:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:x=void 0;if(q||n!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!A||Number((x=A.lastSyncedTimestampSeconds)!=null?x:0)+y<=v){A_=[];r=void 0;if((r=u.tracks)==null?0:r.length)for(NO=g.h(u.tracks),Vr=NO.next();!Vr.done;Vr=NO.next())fZ=Vr.value,A_.push(g.r8(fZ).entityId);mT={playlistId:u.playlistId,videoIds:A_,offlineLastModifiedTimestamp:String(m.toFixed()),autoSync:M,offlineDateAddedTimestamp:String(k.toFixed())};E.push(mT)}b=F.next();g0.ZX(5);break;case 10:return bN=g0.T,g0.return(bN)}})},f0H=function(B,M){var q,D,O,C,K,E,v,F,b,u;
return g.I(function(J){switch(J.C){case 1:return q=g.C0(),g.V(J,ae(),2);case 2:D=J.T;if(!D){J.ZX(3);break}return g.V(J,TQH(D),4);case 4:O=J.T;case 3:var A=O;C={context:g.rA(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:B},offlineClientState:A,clientStateRequestData:{preferredFormatType:M}}}};K=g.B0(XML);g.kZ(J,5);v={T8:!0};return g.V(J,g.sD(q,C,K,void 0,v),7);case 7:E=J.T;g.nZ(J,6);break;case 5:F=g.d0(J);if(F instanceof g.qH)throw b=
"DPS network manager error for smart downloads: "+F.message,DK(b,F),Error(b);DK("DPS fetch request error for smart downloads",F);throw Error("DPS fetch request error for smart downloads");case 6:u=d3(E);if(E)u!==void 0&&GM(u,"smart downloads");else throw DK("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return J.return(E)}})},sbx=function(B,M){var q,D,O,C,K,E,v,F;
return g.I(function(b){switch(b.C){case 1:return q=g.C0(),D={context:g.rA(),videoPlaybackPositionEntities:B,lastSyncTimestampUsec:M},O=g.B0(wMT),g.kZ(b,2),K={T8:!0},g.V(b,g.sD(q,D,O,void 0,K),4);case 4:C=b.T;g.nZ(b,3);break;case 2:E=g.d0(b);if(E instanceof g.qH)throw v="VPPS network manager error: "+E.message,DK(v,E),Error(v);DK("VPPS fetch request error",E);throw Error("VPPS fetch request error");case 3:F=d3(C);if(C)F!==void 0&&GM(F,"position sync");else throw DK("Network request failed for position sync"),
Error("Network request failed for position sync");return b.return(C)}})},iPT=function(B,M,q){var D,O,C,K,E,v,F,b;
return g.I(function(u){switch(u.C){case 1:D=g.C0();var J=q.refreshData,A=q.isEnqueuedForExpiredStreamUrlRefetch,N=q.LB,y=q.offlineSourceData,k=q.mediaCapabilities,m={entityKey:B};J&&(m.refreshData=J);A&&(m.isExpiredStreamUrlRefetch=A);N&&(m.downloadParameters=N);y&&(m.offlineSourceData=y);J={context:g.eY(M),signatureTimestamp:20192,videos:[m]};k&&(J.mediaCapabilities=k);O=J;C=g.B0(R6N);g.kZ(u,2);E={T8:!0};return g.V(u,g.sD(D,O,C,void 0,E),4);case 4:K=u.T;g.nZ(u,3);break;case 2:v=g.d0(u);if(v instanceof
g.qH)throw F="GetPDE network manager error: "+v.message,DK(F,v),Error(F);DK("GetPDE fetch request error",v);throw Error("GetPDE fetch request error");case 3:b=d3(K);if(K)b!==void 0&&GM(b,"PDE");else throw DK("Network request failed for PDE"),Error("Network request failed for PDE");return u.return(K)}})},d3=function(B){var M;
return(M=B.errorMetadata)==null?void 0:M.status},GM=function(B,M){M=M?" for "+M:"";
if(B===0)throw B="Empty response body"+M,DK(B),Error(B);B="Response with error"+M;DK(B);throw Error(B);},pMN=function(B){var M,q,D,O,C,K,E,v;
return g.I(function(F){switch(F.C){case 1:return M=g.C0(),q=Uur(B),D=g.B0(r2N),g.kZ(F,2),C={T8:!0},g.V(F,g.sD(M,q,D,void 0,C),4);case 4:O=F.T;g.nZ(F,3);break;case 2:K=g.d0(F);if(K instanceof g.qH)throw E="offlinePlaylistSyncCheck network manager error: "+K.message,DK(E,K),Error(E);DK("offlinePlaylistSyncCheck fetch request error",K);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:v=d3(O);if(!O)throw DK("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(v!==void 0)GM(v,"playlist sync");else if(!O.offlinePlaylistSyncCheckDatas||!O.offlinePlaylistSyncCheckDatas.length)throw DK("No data for playlist sync"),Error("No data for playlist sync");return F.return(O.offlinePlaylistSyncCheckDatas.map(function(b){return b.offlinePlaylistSyncCheckData}))}})},Pp=function(B){this.C=B},xcu=function(B,M){var q,D,O,C,K,E;
return g.I(function(v){switch(v.C){case 1:q=new Map,D=g.h(M),O=D.next();case 2:if(O.done){v.ZX(4);break}C=O.value;K=q;E=K.set;return g.V(v,B.T(C),5);case 5:E.call(K,C,v.T);O=D.next();v.ZX(2);break;case 4:return v.return(q)}})},lD=function(B,M,q,D,O,C){M=g.x6(M,q);
D=Object.assign({},C,{priority:D,retryScheduleIntervalsInSeconds:O});return{actionType:B,entityKey:M,actionMetadata:D}},Ic=function(B,M,q,D,O,C){this.status=B;
this.C=M;this.W=q;this.T=D;this.B=O;this.downloadState=C},a0o=function(B,M,q){this.C=B;
this.pR=M;this.B=q},qTT=function(B,M){var q,D,O,C,K,E,v,F,b;
return g.I(function(u){switch(u.C){case 1:return q=M.entityKey,O=(D=g.c(M.actionMetadata,Wp))==null?void 0:D.isEnqueuedForExpiredStreamUrlRefetch,g.kZ(u,2),C=void 0,g.V(u,B6r(B,M),4);case 4:C=u.T;g.kZ(u,5);var J=(J=g.c(M.actionMetadata,Wp))?{maximumDownloadQuality:J.maximumDownloadQuality}:void 0;return g.V(u,iPT(q,B.pR,{isEnqueuedForExpiredStreamUrlRefetch:O,LB:J,offlineSourceData:C}),7);case 7:K=u.T;g.nZ(u,6,2);break;case 5:return g.d0(u,2),E=EV(M)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",DK("PDE handleAdd error"),u.return(QQ(M,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",E,"DOWNLOAD_STATE_FAILED"));case 6:return g.V(u,Mpt(B,K,M),8);case 8:return u.return(QQ(M,!0,K.orchestrationActions));case 2:return v=g.d0(u),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.Af&&v.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),DK("PDE handleAdd error"),u.return(QQ(M,!1,void 0,F,b,"DOWNLOAD_STATE_FAILED"))}})},CAu=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg;
return g.I(function(x){switch(x.C){case 1:return q=M.entityKey,D=g.r8(q).entityId,g.V(x,Re(B.C,{mode:"readonly",GR:!0},function(A_){var r=cg(A_,q,"playbackData"),NO=cg(A_,g.x6(D,"offlineVideoPolicy"),"offlineVideoPolicy");A_=cg(A_,g.x6(D,"transfer"),"transfer");return g.kI.all([r,NO,A_])}),2);
case 2:O=x.T;C=g.h(O);K=C.next().value;E=C.next().value;v=C.next().value;F=K;b=E;u=v;if(!F||!b)return x.return(QQ(M,!0));J=[];y=((N=F)==null?0:N.playerResponseJson)?JSON.parse(F.playerResponseJson):null;if(!(u&&y&&B.pR.G("html5_refresh_deprecated_downloads"))){x.ZX(3);break}A=DvL(B,y,u);return g.V(x,O7j(B,u),4);case 4:J=x.T;case 3:k={lastPlayerResponseTimestampSeconds:F.playerResponseTimestamp,offlineToken:b.offlineToken,formatIds:J};m={};if((n=u)==null?0:n.maximumDownloadQuality)m.maximumDownloadQuality=
u.maximumDownloadQuality;g.kZ(x,5);d=void 0;return g.V(x,B6r(B,M),7);case 7:return d=x.T,g.kZ(x,8),g.V(x,iPT(q,B.pR,{refreshData:k,LB:m,offlineSourceData:d,mediaCapabilities:A}),10);case 10:W=x.T;g.nZ(x,9,5);break;case 8:return g.d0(x,5),t=EV(M)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",DK("PDE handleRefresh error"),x.return(QQ(M,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",t,"DOWNLOAD_STATE_FAILED"));
case 9:return g.V(x,Mpt(B,W,M),11);case 11:return x.return(QQ(M,!0,W.orchestrationActions));case 5:return w=g.d0(x),L="PDE handleRefresh error",w instanceof Error&&(L="PDE handleRefresh error: "+w.message),qO="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Dg="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.Af&&w.type==="QUOTA_EXCEEDED"&&(qO="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Dg="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),DK(L),x.return(QQ(M,
!1,void 0,qO,Dg,"DOWNLOAD_STATE_FAILED"))}})},B6r=function(B,M){var q,D,O,C;
return g.I(function(K){if(K.C==1)return q=g.r8(M.entityKey).entityId,D=g.x6(q,"videoDownloadContextEntity"),g.V(K,ro(B.C,D,"videoDownloadContextEntity"),2);O=K.T;return(C=O)!=null&&C.offlineModeType?K.return({offlineModeType:O.offlineModeType}):K.return(void 0)})},Mpt=function(B,M,q){var D,O,C,K,E;
return g.I(function(v){if(v.C==1){if(!M.frameworkUpdates||!g.c(M.frameworkUpdates,ZK))return v.return();if(!(g.c(M.frameworkUpdates,ZK).mutations&&g.c(M.frameworkUpdates,ZK).mutations.length>0&&g.c(M.frameworkUpdates,ZK).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return v.ZX(2);D=g.r8(g.c(M.frameworkUpdates,ZK).mutations[0].entityKey).entityId;return g.V(v,j$(B.C,D),3)}if(v.C!=2){O=v.T;C=g.c(q.actionMetadata,Wp);if(E=(K=C)==null?void 0:K.playlistId)O.playlistId=E;O.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.rY(B.pR)?g.V(v,kB(D,B.C,q,B.B,O),2):g.H5(B.pR)?g.V(v,mu(D,B.C,q,B.B),2):v.ZX(2)}return g.V(v,VrT(g.c(M.frameworkUpdates,ZK)),0)})},QQ=function(B,M,q,D,O,C){return new Ic(M?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",EV(B),q,D,O,C)},DvL=function(B,M,q){M=bPT(B.pR,q.cotn,M);
q=g.o8(M);return g.BU0(M,q,B.pR)},O7j=function(B,M){var q,D,O,C,K,E,v,F,b,u,J;
return g.I(function(A){if(A.C==1)return q=[],g.V(A,Re(B.C,{mode:"readonly",GR:!0},function(N){var y=[],k=M.offlineVideoStreams;if(k){k=g.h(k);for(var m=k.next();!m.done;m=k.next())y.push(cg(N,m.value,"offlineVideoStreams"))}return g.kI.all(y)}),2);
if(D=A.T)for(O=g.h(D),C=O.next();!C.done;C=O.next())if(K=C.value,E=void 0,(E=K)==null?0:E.streamsProgress)for(v=K.streamsProgress,F=0;F<v.length;F++)b=v[F],u=JSON.parse(b.formatStreamBytes),J={itag:u.itag,lmt:u.lastModified,xtags:u.xtags},q.push(J);return A.return(q)})},KUt=function(B,M){this.C=B;
this.pR=M},eLr=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A;
return g.I(function(N){switch(N.C){case 1:return q=EV(M),g.V(N,xw(B.C,"videoPlaybackPositionEntity"),2);case 2:D=N.T;if(D.length===0)return N.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.kZ(N,3);return g.V(N,Uu.getInstance(),5);case 5:O=N.T;if(!O)throw Error("prefStorage is undefined");return g.V(N,O.get("psi"),6);case 6:return C=N.T,v=(E=(K=C)==null?void 0:K.zO)!=null?E:"0",g.V(N,sbx(D,v),7);case 7:return F=N.T,b={isPaused:F.watchHistoryPaused,zO:F.syncTimestampUsec},g.V(N,O.set("psi",
b),8);case 8:if(b.isPaused){N.ZX(9);break}u=g.c(F.frameworkUpdates,ZK);if(!F.frameworkUpdates||!u){N.ZX(9);break}return g.V(N,VrT(u),9);case 9:g.nZ(N,4);break;case 3:return J=g.d0(N),A="PPE handleRefresh error: "+(J instanceof Error?J.message:"unknown error"),DK(A),N.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return N.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},EVu=function(B,M){var q,D,O,C,K,E,v,F;
return g.I(function(b){switch(b.C){case 1:return q=EV(M),D=g.r8(M.entityKey).entityId,g.kZ(b,2),g.V(b,Uu.getInstance(),4);case 4:O=b.T;if(!O)throw Error("prefStorage is undefined");return g.V(b,O.get("psi"),5);case 5:C=b.T;K=g.c(M.actionMetadata,oVu);if(((E=C)==null?void 0:E.isPaused)!==!1||(v=K)==null||!v.lastPlaybackPositionSeconds){b.ZX(6);break}F={key:g.x6(D,"videoPlaybackPositionEntity"),videoId:D,lastPlaybackPositionSeconds:K.lastPlaybackPositionSeconds};return g.V(b,iM(B.C,F,"videoPlaybackPositionEntity"),
6);case 6:g.nZ(b,3);break;case 2:return g.d0(b),b.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},vVu=function(B,M){var q,D,O;
return g.I(function(C){switch(C.C){case 1:q=EV(M);g.kZ(C,2);D=g.r8(M.entityKey).entityId;if(D==="!*$_ALL_ENTITIES_!*$")return g.V(C,kvH(B.C),5);O=g.x6(D,"videoPlaybackPositionEntity");return g.V(C,YeL(B.C,O),5);case 5:g.nZ(C,3);break;case 2:return g.d0(C),C.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return C.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},FUd=function(B,M){this.api=B;
this.C=M;this.logger=new g.E_("woffle");this.T=!1;this.Wc={C4:this.C4};this.logger.debug("Initialized OfflineMediaManager")},b7e=function(B){return g.I(function(M){return M.return(W3Z(B))})},uet=function(B){var M;
return g.I(function(q){if(q.C==1)return g.V(q,g.JVC(B),2);M=q.T;return q.return(M.filter(function(D){return!!D.url}).map(function(D){return D.url}))})},Hp=function(B,M){var q=g.GN(M);
if(q===1||q===0)return Promise.resolve();(q=Joj(B,M))&&q.stopVideo();B.B=0;return b7e(M)},UV=function(B,M,q,D){q=q===void 0?!1:q;
D=D===void 0?!0:D;var O=typeof M==="string"?M:M.videoDetails.videoId;g.GN(O)===2&&((M=Joj(B,O))?M.stopVideo():B.logger.info(function(){return"Corresponding player for "+O+" not found. Pausing anyway"}),g.PX(O,2),B.B=2,q?AoY(B.C):D&&N6o(B.C))},Joj=function(B,M){var q;
return((q=B.player)==null?void 0:q.getVideoData().videoId)===M?B.player:null},zLZ=function(B,M,q){M.getPlayerResponse();
g.PX(M.videoId,2);B.B=2;B.T=!1;var D;(D=B.player)==null||D.dispose();B.player=B.api.SW(M);M={};B.player.uC((M.localmediachange=B.Nt,M.signatureexpired=B.ge,M.statechange=B.t34,M),B);var O=B.C4(q);B.player.nU(g.FO(O,O,!0,"m"),!1);B.logger.debug(function(){return"Starting headless playback with quality: "+O});
B.player.QW(!1)},$vj=function(B,M){this.C=B;
this.pR=M},yoY=function(B,M){var q,D;
return g.I(function(O){switch(O.C){case 1:return q=EV(M),g.V(O,ro(B.C,M.entityKey,"transfer"),2);case 2:if(D=O.T)return O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.kZ(O,3);return g.V(O,hLZ(B,M),5);case 5:g.nZ(O,4);break;case 3:return g.d0(O),O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},YTM=function(B,M){var q,D;
return g.I(function(O){switch(O.C){case 1:return q=EV(M),g.V(O,ro(B.C,M.entityKey,"transfer"),2);case 2:D=O.T;if(!D||D.transferState!=="TRANSFER_STATE_COMPLETE")return O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.kZ(O,3);return g.V(O,hLZ(B,M,!0),5);case 5:g.nZ(O,4);break;case 3:return g.d0(O),O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},kFo=function(B,M){var q,D,O,C,K,E,v,F,b,u;
return g.I(function(J){switch(J.C){case 1:return q=EV(M),D=g.r8(M.entityKey).entityId,g.V(J,Re(B.C,{mode:"readonly",GR:!0},function(A){var N=cg(A,M.entityKey,"transfer");A=cg(A,g.x6(D,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.kI.all([N,A])}),2);
case 2:O=J.T;C=g.h(O);K=C.next().value;E=C.next().value;v=K;F=E;if(!v||v.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return J.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.kZ(J,3);v.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.V(J,iM(B.C,v,"transfer"),5);case 5:b=g.r8(v.key).entityId;Kru({videoId:b,o$:v,offlineModeType:(u=F)==null?void 0:u.offlineModeType});g.nZ(J,4);break;case 3:return g.d0(J),J.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return J.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},hLZ=function(B,M,q){q=q===void 0?!1:q;
var D,O,C,K,E,v,F,b,u,J,A,N,y,k,m;return g.I(function(n){switch(n.C){case 1:return D=g.c(M.actionMetadata,Z7M),O=g.r8(M.entityKey).entityId,C=g.x6(O,"downloadStatusEntity"),g.V(n,Re(B.C,{mode:"readonly",GR:!0},function(d){var W=cg(d,C,"downloadStatusEntity");d=cg(d,g.x6(O,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.kI.all([W,d])}),2);
case 2:return K=n.T,E=g.h(K),v=E.next().value,F=E.next().value,b=v,u=F,J="TRANSFER_STATE_TRANSFER_IN_QUEUE",((A=b)==null?void 0:A.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(J="TRANSFER_STATE_PAUSED_BY_USER"),k={key:M.entityKey,transferState:J,cotn:g.Y9(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(N=D)==null?void 0:N.maximumDownloadQuality,preferredAudioTrack:(y=D)==null?void 0:y.preferredAudioTrack,transferRetryCount:0,isRefresh:q,hasLoggedFirstStarted:!1},g.V(n,Re(B.C,
{mode:"readwrite",GR:!0},function(d){var W=[];q&&W.push(LS(d,g.x6(O,"offlineVideoStreams")));W.push(Tk(d,k,"transfer"));return g.kI.all(W)}),3);
case 3:if(!q){n.ZX(4);break}return g.V(n,b7e(O),4);case 4:OPu({videoId:O,o$:k,offlineModeType:(m=u)==null?void 0:m.offlineModeType}),g.YZ(n)}})},mvd=function(B,M,q,D){if(!B.action.entityKey)throw Error("entityKey is missing.");
var O=g.r8(B.action.entityKey);O={entityType:O.Rv,entityId:O.entityId,offlineOrchestrationActionType:B.action.actionType,orchestrationAction:{orchestrationActionId:B.actionId}};M&&(O.offlineOrchestrationActionResult=M.status,O.isRetryable=q?!1:M.C,M.B&&(O.offlineOrchestrationFailureReason=jYj(M.B,O.isRetryable)));var C,K;if((C=B.action.actionMetadata)==null?0:(K=C.offlineLoggingData)==null?0:K.offlineModeType)O.offlineModeType=B.action.actionMetadata.offlineLoggingData.offlineModeType;D&&(O.additionalOrchestrationActions=
D.map(function(E){return{orchestrationActionId:E.actionId}}));
return O},jYj=function(B,M){return B!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||M?B==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&M?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":B:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},nVx=function(B,M){var q={offlineOrchestrationContext:mvd(B)};
M=Sej(M,q);fmN(cBe(),M,B.rootActionId)},Vpt=function(B,M,q,D){D=D===void 0?[]:D;
M={offlineOrchestrationContext:mvd(B,M,q,D)};M=Sej(3,M);fmN(cBe(),M,B.rootActionId)},gVr=function(){this.actions=[]},dve=function(B,M){M=g.h(M);
for(var q=M.next();!q.done;q=M.next())q=q.value,nVx(q,1),B.actions.push(q);B.actions.sort(B.C)},GFt=function(B,M){if(M)for(var q=0;q<B.actions.length;q++)if(M==="!*$_ALL_ENTITIES_!*$"&&B.actions[q].actionId!==M||M!=="!*$_ALL_ENTITIES_!*$"&&B.actions[q].rootActionId===M&&B.actions[q].actionId!==M)B.actions.splice(q,1),q--},PAH=function(B,M){B=g.h(B.actions);
for(var q=B.next();!q.done;q=B.next())if(q.value.actionId===M)return!0;return!1},tu=function(B,M,q,D,O){g.H.call(this);
var C=this;this.T=B;this.W8=M;this.v8=q;this.D=D;this.pR=O;this.C=new gVr;this.K=new g.XW;this.B=new g.LP(function(){C.retry()});
this.Y=NaN;this.J=!1;this.Wc={gmi:function(){return C.C},
Fu:function(){return C.K},
m8R:function(){return C.B},
retry:function(){return C.retry()}};
g.p(this,this.B);this.U=this.T.observe(this.CR.bind(this))},WUZ=function(B,M,q,D,O){var C;
return g.I(function(K){if(K.C==1)return C=new tu(B,M,q,D,O),g.V(K,l8Y(C),2);I8d(C);return K.return(C)})},I8d=function(B){var M=B.C.actions[0];
return B.W?((M==null?void 0:M.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&B.W[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(B.J=!0),Promise.resolve()):QYH(B)},QYH=function(B){var M,q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m;
return g.I(function(n){switch(n.C){case 1:if(B.W)throw Error("Already processing an action");if(B.i5())return n.return();M=B.C.actions.shift();qxr(B.v8,!M);if(M===void 0)return n.return();M.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&M.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&GFt(B.C,M.actionId);q="";M.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&M.rootActionId===M.actionId&&(q=M.actionId);D=[M];B.W=D;if(O=B.W8[M.entityType]){n.ZX(2);break}B.W=
void 0;return g.V(n,QYH(B),3);case 3:return n.return();case 2:C=g.h(D);for(K=C.next();!K.done;K=C.next())E=K.value,nVx(E,2);g.kZ(n,4,5);return g.V(n,xcu(O,D.map(function(d){return d.action})),7);
case 7:v=n.T,F=g.h(D),b=F.next();case 8:if(b.done){n.ZX(10);break}u=b.value;J=v.get(u.action);return g.V(n,H7d(B,u,J),9);case 9:b=F.next();n.ZX(8);break;case 10:GFt(B.C,q);case 5:g.PU(n);B.W=void 0;g.lg(n,6);break;case 4:return A=g.d0(n),DK("Orchestration error",A),g.kZ(n,12),g.V(n,Uvu(B,D),14);case 14:g.nZ(n,5);break;case 12:N=g.d0(n);DK("Orchestration retry error",N);y=g.h(D);for(k=y.next();!k.done;k=y.next())m=k.value,m.retryScheduleIndex<3&&dve(B.C,[m]);n.ZX(5);break;case 6:return g.V(n,QYH(B),
0)}})},H7d=function(B,M,q){var D,O,C,K,E,v,F,b,u,J,A,N;
return g.I(function(y){switch(y.C){case 1:D=M.retryScheduleIndex+2===3;if(q.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){y.ZX(2);break}if(q.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){y.ZX(0);break}Vpt(M,q,D);if(q.C&&M.retryScheduleIndex+1<3)return g.V(y,Uvu(B,[M]),0);C=((O=q)==null?0:O.T)?q.T:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";K={entityKey:M.action.entityKey,failureReason:C};E=void 0;g.rY(B.pR)?E="mainVideoDownloadStateEntity":g.H5(B.pR)&&(E="musicTrackDownloadMetadataEntity");
if(!E||!q.downloadState){y.ZX(7);break}v=g.r8(M.action.entityKey).entityId;return g.V(y,uD(v,E,B.T,q.downloadState),7);case 7:C$(B.D,K);if(q.downloadState==="DOWNLOAD_STATE_FAILED"&&B.pR.G("html5_auto_retry_failed_pde_actions")){y.ZX(0);break}DK("Orchestration result is not retryable, deleting action");return g.V(y,YeL(B.T,hu(M).key),0);case 2:F=void 0;try{F=(b=q.W)==null?void 0:b.map(function(k){return B.createAction(k,M)})}catch(k){return Vpt(M,q,D),u={entityKey:M.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},C$(B.D,u),DK("Orchestration subactions creation error",k),y.return()}Vpt(M,q,D,F);if(!F){y.ZX(12);break}J=F.map(function(k){return hu(k)});
A=0;case 13:if(!(A<F.length)||B.J){y.ZX(15);break}return g.V(y,Re(B.T,{mode:"readwrite",GR:!0},function(k){var m=[];m.push(F3u(k,J.slice(A,A+10),"offlineOrchestrationActionWrapperEntity"));return g.kI.all(m)}),16);
case 16:A+=10;y.ZX(13);break;case 15:if(B.J)return B.J=!1,y.return();case 12:return N=hu(M),g.V(y,YeL(B.T,N.key),17);case 17:nVx(M,4),g.YZ(y)}})},STx=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A;
return g.I(function(N){q=[];D=Infinity;O=4E3;C=g.h(M);for(K=C.next();!K.done;K=C.next())E=K.value,v=Number(E.enqueueTimeSec),F=tpu(v),b=E.retryScheduleIndex,u=b!=null&&b>0,F>0&&u?(D=Math.min(D,v),O=Math.min(F,O)):q.push(E);isFinite(D)&&(!B.B.isActive()||D<B.Y)&&(B.Y=D,B.B.start(O));B.K.cF()||(J=q.length,q=q.filter(function(y){var k;y=((k=y.actionProto)==null?void 0:k.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!prM.includes(y)}),A=q.length<J,!B.B.isActive()&&A&&B.B.start(1));
q.length>0&&coZ(B,q);return g.V(N,I8d(B),0)})},T6j=function(B){var M,q,D,O,C,K,E;
return g.I(function(v){if(v.C==1)return g.V(v,f8t(B),2);M=v.T;q=[];D=g.h(M);for(O=D.next();!O.done;O=D.next())C=O.value,K=g.r8(C.key),E=K.entityId,PAH(B.C,E)||q.push(C);return g.V(v,STx(B,q),0)})},tpu=function(B){B=B*1E3-Date.now();
return B>4E3?4E3:B},Uvu=function(B,M){var q,D,O;
return g.I(function(C){q=g.h(M);for(D=q.next();!D.done;D=q.next()){O=D.value;var K=void 0,E=void 0,v=((E=O.action)==null?void 0:(K=E.actionMetadata)==null?void 0:K.retryScheduleIntervalsInSeconds)||[1,2,4];K=1;O.retryScheduleIndex<v.length&&(K=v[O.retryScheduleIndex]);O.C=K*1E3+Date.now();O.retryScheduleIndex++}return g.V(C,LUx(B,M),0)})},l8Y=function(B){var M;
return g.I(function(q){if(q.C==1)return g.V(q,xw(B.T,"offlineOrchestrationActionWrapperEntity"),2);M=q.T;return g.V(q,STx(B,M),0)})},coZ=function(B,M){M.length!==0&&M.forEach(function(q){q=$B(q);
q.retryScheduleIndex<3&&dve(B.C,[q])})},f8t=function(B,M){var q;
return g.I(function(D){if(D.C==1)return g.V(D,xw(B.T,"offlineOrchestrationActionWrapperEntity",M),2);q=D.T;return D.return(q.filter(g8M))})},LUx=function(B,M){if(M.length===0)return Promise.resolve([]);
M=M.map(function(q){return hu(q)});
return yBd(B.T,M)},Xrt=function(B){this.mL=B;
this.C=void 0},wrT=function(B,M){var q,D,O,C;
return g.I(function(K){q=M.videoId;D=!0;if(M.captionTracks.length)O=e1t(M),B.C=new g.uv(B.mL,M,O);else if(M.VN)C=g.mGU(M),B.C=new g.AW(B.mL,M.VN,q,C,M.gX,M.eventId),D=M.gX;else return K.return();return K.return(new Promise(function(E){var v;(v=B.C)==null||v.O3({HK:function(){return g.I(function(F){if(F.C==1)return g.V(F,B.HK(q,D),2);E();g.YZ(F)})},
py:function(){}})}))})},sYM=function(B){var M;
return g.I(function(q){if(q.C==1)return g.V(q,Ime(B),2);M=q.T;return q.return(!!M&&M.length>0)})},p$=function(B){g.H.call(this);
this.C=B;this.T=this.C.observe(this.B.bind(this))},RLY=function(B,M){var q,D,O,C,K,E,v;
return g.I(function(F){switch(F.C){case 1:if(M.length===0)return F.return([]);q=M.map(function(b){return g.x6(b,"transfer")});
return g.V(F,xw(B.C,"transfer",q),2);case 2:D=F.T;O=D.filter(g8M).map(function(b){return g.r8(b.key).entityId});
C=M.filter(function(b){return O.indexOf(b)===-1});
if(C.length===0)return F.return([]);K=g.h(C);E=K.next();case 3:if(E.done){F.ZX(5);break}v=E.value;return g.V(F,b7e(v),4);case 4:E=K.next();F.ZX(3);break;case 5:return F.return(C)}})},xvM=function(B,M,q,D,O,C){var K,E,v;
return g.I(function(F){K="STREAM_TYPE_UNKNOWN";q.video&&q.audio?(K="STREAM_TYPE_AUDIO_AND_VIDEO",DK("unexpected stream type")):q.video&&!q.audio?K="STREAM_TYPE_VIDEO":!q.video&&q.audio&&(K="STREAM_TYPE_AUDIO");E=g.x6(M,"offlineVideoStreams");v={numBytesDownloaded:O.toFixed(),numTotalBytes:C.toFixed(),streamType:K,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(D),itag:K==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(q.itag):void 0};return g.V(F,Re(B,{mode:"readwrite",GR:!0},
function(b){var u=cg(b,E,"offlineVideoStreams"),J=cg(b,g.x6(M,"transfer"),"transfer");return g.kI.all([u,J]).then(function(A){A=g.h(A);var N=A.next().value;A=A.next().value;if(!A)return LS(b,E).then(function(){});
var y=i7t(N);N=rox(N,D,v,E);var k=Tk(b,N,"offlineVideoStreams");i7t(N)>y&&(A.lastProgressTimeMs=Date.now().toString());y=[k];A.offlineVideoStreams||(A.offlineVideoStreams=[]);A.offlineVideoStreams.indexOf(E)===-1&&(A.offlineVideoStreams.push(E),y.push(Tk(b,A,"transfer")));return g.kI.all(y)})}),0)})},a8u=function(B,M){var q,D,O,C,K;
return g.I(function(E){if(E.C==1)return q=g.x6(M,"offlineVideoStreams"),g.V(E,ro(B,q,"offlineVideoStreams"),2);D=E.T;if(!D||!D.streamsProgress)return E.return();O=g.h(D.streamsProgress);for(C=O.next();!C.done;C=O.next())K=C.value,K.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",K.numTotalBytes!==K.numBytesDownloaded&&(K.numBytesDownloaded=K.numTotalBytes);return g.V(E,iM(B,D,"offlineVideoStreams"),0)})},rox=function(B,M,q,D){if(B&&B.streamsProgress){D=B;
a:{M=M.itag+";"+M.xtags;for(var O=B.streamsProgress,C=0;C<O.length;C++){var K=JSON.parse(O[C].formatStreamBytes);if(K.itag+";"+K.xtags===M){O[C]=q;q=O;break a}}O.push(q);q=O}D.streamsProgress=q}else B={key:D,streamsProgress:[q]};return B},i7t=function(B){if(B==null?0:B.streamsProgress){var M=0;
B=B.streamsProgress;for(var q=0;q<B.length;q++){var D=B[q];isNaN(Number(D.numBytesDownloaded))?DK("stream progress bytes number invalid"):M+=Number(D.numBytesDownloaded)}return M}return 0},Bko=function(B,M,q,D){g.H.call(this);
var O=this;this.T=B;this.api=M;this.I4=q;this.CR=D;this.K=new g.XW;this.W=new g.LP(function(){O.C&&O.C.transferState==="TRANSFER_STATE_TRANSFERRING"&&O.K.cF()&&((O.C.transferRetryCount||0)<3?UV(O.D,O.J,!1,!1):Hp(O.D,O.J.videoDetails.videoId),O.lm("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.v8=this.o4=0;this.U=this.Y=!1;this.c8=g.ui(this.api.S().experiments,"html5_transfer_processing_logs_interval");this.Gh=new g.td(this);this.Wc={OZu:function(){return O.W},
omP:function(){return O.CR},
Fu:function(){return O.K}};
this.W8=this.T.observe(this.jD.bind(this));this.D=new FUd(M,this);this.OC=new Xrt(M);this.jY=new p$(this.T);this.Aq=this.K.listen("publicytnetworkstatus-online",this.kH.bind(this));this.qG=this.K.listen("publicytnetworkstatus-offline",this.nDu.bind(this));this.U=this.api.S().G("html5_less_transfer_processing_logs");g.p(this,this.Gh);this.Gh.V(M,"offlinetransferpause",this.hdX);g.rY(this.api.S())?this.B="mainVideoDownloadStateEntity":g.H5(this.api.S())&&(this.B="musicTrackDownloadMetadataEntity")},
MQo=function(B){return g.I(function(M){if(M.C==1)M=g.V(M,Phd(),2);
else{var q=B.jY;var D=g.dE();D=Object.keys(D);q=RLY(q,D);M=g.V(M,q,0)}return M})},S$=function(B,M){M=M===void 0?!1:M;
var q;return g.I(function(D){if(D.C==1){if(B.C)throw Error("Already downloading a video");B.v8=0;B.Y=!1;return g.V(D,qJu(B),2)}return D.C!=4?(q=D.T,Dcj(B.I4,!q),q&&B.K.cF()?M?g.V(D,new Promise(function(O){g.uB(O,1E3)}),4):D.ZX(4):(!q&&B.C&&cp(B),D.ZX(0))):g.V(D,DAj(B,q),0)})},ONM=function(B){return g.I(function(M){if(M.C==1)return B.J?g.V(M,Hp(B.D,B.J.videoDetails.videoId),3):M.ZX(0);
cp(B);g.YZ(M)})},CYL=function(B,M){var q,D,O;
return g.I(function(C){switch(C.C){case 1:return g.kZ(C,2),(q=!!M.captionTracks.length||!!M.VN)?g.V(C,sYM(M.videoId),4):C.return();case 4:return(D=C.T)?C.return():g.V(C,wrT(B.OC,M),5);case 5:g.nZ(C,0);break;case 2:O=g.d0(C),DK("Caption downloading error",O,M.cotn),g.YZ(C)}})},DAj=function(B,M){var q,D,O,C,K,E;
return g.I(function(v){switch(v.C){case 1:if(B.Y)return v.return();B.Y=!0;B.C=M;q=g.r8(B.C.key);D=q.entityId;O=void 0;if(B.C.transferState==="TRANSFER_STATE_TRANSFERRING")return g.V(v,f$(B,D),7);if(B.C.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||B.C.transferRetryCount||B.C.hasLoggedFirstStarted){v.ZX(3);break}return g.V(v,f$(B,D),5);case 5:return O=v.T,B.C.hasLoggedFirstStarted=!0,g.V(v,KgN(B),6);case 6:CxH({videoId:D,o$:B.C,offlineModeType:O},void 0,void 0,!0);v.ZX(3);break;case 7:O=v.T,
oc({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:D,o$:B.C,offlineModeType:O});case 3:return g.V(v,e2N(B),8);case 8:return C=null,g.kZ(v,9),g.V(v,oPd(B,M),11);case 11:C=v.T;B.J=C;g.nZ(v,10);break;case 9:return K=g.d0(v),DK("error getting player response",K,M.cotn),g.V(v,B.lm("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return v.return();case 10:return E=bPT(B.api.S(),M.cotn,C),g.V(v,CYL(B,E),13);case 13:return g.V(v,uet(E.videoId),
14);case 14:E.Ng=v.T,zLZ(B.D,E,M.maximumDownloadQuality),B.W.start(108E5),g.YZ(v)}})},qJu=function(B){var M,q;
return g.I(function(D){if(D.C==1)return g.V(D,xw(B.T,"transfer"),2);M=D.T;q=M.filter(EPt).sort(vPd);return q.length===0?D.return():D.return(q[0])})},e2N=function(B){var M,q,D;
return g.I(function(O){if(O.C==1){if(!B.C)return TM(B,"onTransferStart"),O.return();B.W.start(108E5);return g.V(O,L$(B,"TRANSFER_STATE_TRANSFERRING"),2)}M=B.C;return(D=((q=M)==null?0:q.key)?g.r8(M.key).entityId:"")&&B.B?g.V(O,uD(D,B.B,B.T,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):O.ZX(0)})},AoY=function(B){var M,q,D,O;
g.I(function(C){switch(C.C){case 1:if(!B.C){TM(B,"onTransferPausedByUser");C.ZX(2);break}M=B.C;B.W.stop();return g.V(C,L$(B,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:D=((q=M)==null?0:q.key)?g.r8(M.key).entityId:"";if(!D||!B.B){C.ZX(4);break}return g.V(C,uD(D,B.B,B.T,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.V(C,f$(B,D),6);case 6:O=C.T,e6e({videoId:D,o$:M,offlineModeType:O});case 2:cp(B),S$(B),g.YZ(C)}})},N6o=function(B){var M,q,D;
g.I(function(O){if(O.C==1){if(!B.C)return TM(B,"onTransferPausedByNetwork"),O.return();B.W.stop();return g.V(O,L$(B,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(O.C!=3)return M=B.C,(D=((q=M)==null?0:q.key)?g.r8(M.key).entityId:"")&&B.B?g.V(O,uD(D,B.B,B.T,"DOWNLOAD_STATE_PAUSED"),3):O.ZX(3);cp(B);g.YZ(O)})},Fgu=function(B){var M,q,D,O,C;
g.I(function(K){switch(K.C){case 1:if(!B.C)return TM(B,"onTransferComplete"),K.return();M=B.C;B.W.stop();if(!M||!B.J){K.ZX(2);break}q=bPT(B.api.S(),M.cotn,B.J);return g.V(K,CYL(B,q),2);case 2:return g.V(K,L$(B,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:O=((D=M)==null?0:D.key)?g.r8(M.key).entityId:"";if(!O||!B.B){K.ZX(5);break}return g.V(K,uD(O,B.B,B.T,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.V(K,a8u(B.T,O),7);case 7:return g.V(K,f$(B,O),8);case 8:C=K.T,oc({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:O,o$:M,offlineModeType:C}),cp(B),S$(B),g.YZ(K)}})},bNM=function(B,M,q){var D,O;
g.I(function(C){switch(C.C){case 1:if(!B.C)return TM(B,"onTransferProgress: "+M),C.return();if(B.C.transferState==="TRANSFER_STATE_TRANSFERRING"){C.ZX(2);break}return g.V(C,e2N(B),2);case 2:D=Date.now();if(!(D-B.o4>1E3)){C.ZX(4);break}B.o4=D;return g.V(C,xvM(B.T,q.videoId,q.T,q.SJ,q.bytesDownloaded,q.C),5);case 5:if(B.U&&!(B.U&&D-B.v8>B.c8)){C.ZX(4);break}B.v8=D;return g.V(C,f$(B,M),7);case 7:O=C.T,CxH({videoId:M,o$:B.C,offlineModeType:O},q.bytesDownloaded,q.C);case 4:B.W.start(108E5),g.YZ(C)}})},
uRx=function(B){var M=(B.C.transferRetryCount||0)<3;
M&&(B=B.C,B.transferRetryCount=(B.transferRetryCount||0)+1);return M},J3L=function(B,M){M=M===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":M;
var q,D,O,C;return g.I(function(K){if(K.C==1)return B.C||TM(B,"setTransferToFailed: "+M),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M==="TRANSFER_FAILURE_REASON_NETWORK"?q="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":M==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.V(K,L$(B,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",M),2);if(K.C!=3)return C$(B.CR,{entityKey:(D=B.C)==null?void 0:D.key,failureReason:q}),
O=B.C?g.r8(B.C.key).entityId:"",g.V(K,f$(B,O),3);C=K.T;var E={videoId:O,o$:B.C,offlineModeType:C},v=M,F={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};v&&(F.transferFailureReason=v,F.failureReason=osL(v));oc(F,E);g.YZ(K)})},L$=function(B,M,q,D){var O;
return g.I(function(C){if(C.C==1){if(!B.C)return TM(B,"saveTransferState: "+M),C.return();B.C.transferState=M;B.C.failureReason=D;g.kZ(C,2);return g.V(C,KgN(B,function(K){return q?SU(K,"offlineVideoStreams",B.C.offlineVideoStreams).then(function(E){for(var v=g.h(E),F=v.next();!F.done;F=v.next())if((F=F.value)&&F.streamsProgress){F=g.h(F.streamsProgress);for(var b=F.next();!b.done;b=F.next())b.value.streamState=q}return F3u(K,E.filter(function(u){return!!u}),"offlineVideoStreams")}):g.kI.resolve(void 0)}),
4)}if(C.C!=2)return g.nZ(C,0);
O=g.d0(C);return O instanceof g.Af&&O.type==="QUOTA_EXCEEDED"?g.V(C,B.lm("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):C.ZX(0)})},KgN=function(B,M){var q;
return g.I(function(D){if(!B.C)return D.return();q=B.C;return g.V(D,Re(B.T,{mode:"readwrite",GR:!0},function(O){var C=[Tk(O,q,"transfer")];M&&C.push(M(O));return g.kI.all(C)}),0)})},cp=function(B){B.C=void 0;
B.J=void 0;B.W.stop()},oPd=function(B,M){var q,D,O,C,K;
return g.I(function(E){if(E.C==1)return q=g.r8(M.key),D=q.entityId,O=g.x6(D,"playbackData"),g.V(E,ro(B.T,O,"playbackData"),2);C=E.T;if((K=C)==null?0:K.playerResponseJson)return E.return(JSON.parse(C.playerResponseJson));throw Error("No PlayerResponse found");})},TM=function(B,M){B.api.hq("woffle",{mcte:M});
DK("missing current transfer entity.")},f$=function(B,M){var q,D,O;
return g.I(function(C){if(C.C==1)return g.V(C,ro(B.T,g.x6(M,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);q=C.T;return C.return((O=(D=q)==null?void 0:D.offlineModeType)!=null?O:void 0)})},EPt=function(B){return A3d[B.transferState]!==void 0},vPd=function(B,M){var q=A3d[B.transferState],D=A3d[M.transferState];
return q!==D?q-D:Number(B.enqueuedTimestampMs)-Number(M.enqueuedTimestampMs)},XY=function(B,M){var q=this;
this.pR=B;this.api=M;this.K=new g.XW;this.J=new g.vc;this.Wc={cw:function(){return q.B.Wc.cw()},
Fu:function(){return q.K},
ZZn:function(){return q.B},
B6:function(){return q.B6()},
PP:function(){return q.PP()},
cP:function(){return q.cP()},
Ni:function(){return q.Ni()},
Om:function(){return q.Om()},
DJ:function(D){return q.DJ(D)}};
this.B=new amx(function(){return NkT(q)},function(){q.cP()},this.api.LC(),this.api.G.bind(this.api));
this.C=new OV(this.api);BzL(this.B)},NkT=function(B){return g.I(function(M){B.api.EC("onOrchestrationBecameLeader");
return g.V(M,B.PP(),0)})},$AY=function(B){var M,q;
return g.I(function(D){if(D.C==1)return g.V(D,ae(),2);if(D.C!=3){M=D.T;if(!M)return DK("PES is undefined"),D.return();B.T=new Bko(M,B.api,B.B,B.C);q=B.qw(M);return g.V(D,WUZ(M,q,B.B,B.C,B.pR),3)}B.D=D.T;return g.V(D,z2H(B),0)})},z2H=function(B){var M;
return g.I(function(q){switch(q.C){case 1:if(!B.T)return DK("transferManager is undefined"),q.return();if(B.T.C){q.ZX(2);break}return g.V(q,S$(B.T),2);case 2:if(!B.pR.G("woffle_enable_main_downloads_library")){q.ZX(4);break}return g.V(q,B.RB(),4);case 4:if(!B.pR.G("html5_offline_playback_position_sync")){q.ZX(6);break}return g.V(q,B.pJ(),7);case 7:return g.V(q,B.DJ(864E5),6);case 6:return g.V(q,B.refreshAllStaleEntities(43200,!0),9);case 9:return g.V(q,B.SO(),10);case 10:if(!B.pR.G("html5_retry_downloads_for_expiration")){q.ZX(11);
break}return g.V(q,B.Om(),11);case 11:return B.Y=g.Jw(function(){B.refreshAllStaleEntities(43200,!0);B.SO()},9E5),g.rM(g.an(),function(){return B.Ni()}),g.V(q,ae(),13);
case 13:return M=q.T,g.V(q,xue(M),14);case 14:MFN(B.B),g.YZ(q)}})},h2T=function(){var B,M,q,D,O,C;
return g.I(function(K){switch(K.C){case 1:return g.V(K,ae(),2);case 2:B=K.T;if(!B)return K.return([]);M=Date.now()/1E3;return g.V(K,xw(B,"offlineVideoPolicy"),3);case 3:q=K.T,D=g.h(q),O=D.next();case 4:if(O.done){K.ZX(6);break}C=O.value;if(!(C.expirationTimestamp&&Number(C.expirationTimestamp)<M)){K.ZX(5);break}C.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";C.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.V(K,iM(B,C,"offlineVideoPolicy"),5);
case 5:O=D.next();K.ZX(4);break;case 6:return K.return(q.map(function(E){return E.key}))}})},w3=function(B,M,q,D,O){var C,K,E;
return g.I(function(v){if(v.C==1)return g.V(v,ae(),2);C=v.T;if(!C)return v.return([]);K=M.map(function(F){var b=g.x6(F,q);b={actionType:D,entityKey:b,actionMetadata:Object.assign({},ukr(),O)};D!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(b.actionMetadata.priority=0);F=new zM(q,F,b);return hu(F)});
E=yBd(C,K);BzL(B.B);return v.return(E)})},y3x=function(B,M,q,D){var O,C,K,E,v,F,b,u;
return g.I(function(J){switch(J.C){case 1:O=[],C=g.h(M),K=C.next();case 2:if(K.done){J.ZX(4);break}E=K.value;if(E.upToDate||q&&!E.shouldAutoSyncMetadata||!E.playlistId){J.ZX(3);break}v={};switch(D){case "mainPlaylistEntity":F={nextAutoRefreshIntervalSeconds:E.checkInSeconds,autoSync:q};v={mainPlaylistEntityActionMetadata:F};break;case "musicPlaylist":b={autoSync:q},v={musicPlaylistEntityActionMetadata:b}}return g.V(J,w3(B,[E.playlistId],D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",v),6);case 6:(u=
J.T)&&O.push.apply(O,g.Y(u));case 3:K=C.next();J.ZX(2);break;case 4:return J.return(O)}})},YJu=function(B,M){var q;
return g.I(function(D){return M.length?(q=ukr(),g.pE(q,Wp,{isEnqueuedForExpiredStreamUrlRefetch:!0}),B.api.hq("qrd",{v:M.length}),D.return(w3(B,M,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q))):D.return([])})},kWj=function(B,M,q){this.C=B;
this.pR=M;this.B=q},mAT=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n;
return g.I(function(d){switch(d.C){case 1:return q=EV(M),D=g.r8(M.entityKey),O=D.entityId,C=[],g.kZ(d,2),g.V(d,ZNM(B,O),4);case 4:C=d.T;if(!(B.pR.G("woffle_enable_main_downloads_library")&&((K=C)==null?0:K.length))){d.ZX(5);break}return g.V(d,nsu(B.C,[M.entityKey]),5);case 5:g.nZ(d,3);break;case 2:return E=g.d0(d),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.Af&&E.type==="QUOTA_EXCEEDED"?(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):DK("Playlist add error"),d.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,v,F));case 3:b=[];if(!B.pR.G("html5_offline_prevent_redownload_downloaded_video")){d.ZX(7);break}return g.V(d,FrH(B.C,"mainVideoEntity",C),8);case 8:C=d.T;case 7:if((u=C)==null?0:u.length)for(J=g.h(C),A=J.next();!A.done;A=J.next())if(N=A.value,y=N.offlineVideoData,k=void 0,(k=y)==null?0:k.videoId)m=void 0,n=Number(((m=M.actionMetadata)==null?void 0:m.priority)||
0)+1,b.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y.videoId,"mainVideoEntity",n,sV,jFH(M,y,O)));return d.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,b))}})},VQZ=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r,NO,Vr,fZ,mT,bN,g0,mm,Oo,Z,e1,Rt,Zf,PZ,AL,t_,HZ,lN,G,P,l,U,S,Zg,MO,$Z,OC,GK,r0,Zj,jG,Wy,XV,s9,wp,kF,u3,Gj,hy,PV,St,fb,mK,Ct,sK,o0,mr,SQ;
return g.I(function($o){switch($o.C){case 1:return q=EV(M),D=M.entityKey,O=g.r8(D).entityId,C=[],K=!1,O==="!*$_ALL_ENTITIES_!*$"?(K=!0,g.V($o,xw(B.C,"mainPlaylistEntity"),5)):g.V($o,ro(B.C,D,"mainPlaylistEntity"),4);case 4:(E=$o.T)&&C.push(E);$o.ZX(3);break;case 5:C=$o.T;case 3:if((v=C)==null||!v.length)return $o.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));F=g.c(M.actionMetadata,nPM);u=(b=F)==null?void 0:b.nextAutoRefreshIntervalSeconds;A=(J=F)==null?void 0:J.autoSync;N=[];k=y=
!0;m=!1;if(!K&&A===!1){$o.ZX(6);break}g.kZ($o,7);return g.V($o,c2M(0,!!A,!0,C),9);case 9:N=$o.T;g.nZ($o,8);break;case 7:n=g.d0($o);if(!(n instanceof Error&&n.message==="No data")){n instanceof Error&&n.message==="Empty response body"&&DK(n.message);$o.ZX(8);break}return O==="!*$_ALL_ENTITIES_!*$"?g.V($o,y2u(B.C,M,B.B,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.V($o,$cN(O,B.C,M,B.B),8);case 8:if(!N.length||!K&&N[0].playlistId!==O)return $o.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q));case 6:if(K){d=[];W=g.h(N);for(t=W.next();!t.done;t=W.next())w=t.value,w.upToDate||A&&!w.shouldAutoSyncMetadata||!w.playlistId||(L={nextAutoRefreshIntervalSeconds:w.checkInSeconds,autoSync:A},d.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",w.playlistId,"mainPlaylistEntity",0,sV,{mainPlaylistEntityActionMetadata:L})));return $o.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,d))}N.length&&(qO=N[0],m=!!qO.upToDate,A&&(y=(Dg=qO.shouldAutoSyncMetadata)!=null?Dg:!0,k=(x=qO.shouldAutoSyncVideos)!=
null?x:!0,qO.checkInSeconds&&(u=qO.checkInSeconds)));if(m||!y)return $o.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));A_=[];r=C[0];if(!r.downloadState){NO=void 0;$o.ZX(15);break}return g.V($o,ro(B.C,r.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:NO=$o.T;case 15:return Vr=NO,mT=((fZ=Vr)==null?0:fZ.addedTimestampMillis)?String(Vr.addedTimestampMillis):void 0,g.kZ($o,17),g.V($o,ZNM(B,O,mT,u),19);case 19:A_=$o.T;g.nZ($o,18);break;case 17:bN=g.d0($o);if(!(bN instanceof
Error&&bN.message==="No data for playlist")){if(bN instanceof Error&&bN.message==="Empty response body for playlist")DK(bN.message);else return g0="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",mm="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",bN instanceof g.Af&&bN.type==="QUOTA_EXCEEDED"&&(g0="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",mm="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),$o.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,g0,mm));
$o.ZX(18);break}return g.V($o,$cN(O,B.C,M,B.B),18);case 18:if(!k)return $o.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));Oo=[];Z=new Map;if((e1=A_)==null?0:e1.length)for(Rt=g.h(A_),Zf=Rt.next();!Zf.done;Zf=Rt.next())PZ=Zf.value,AL=PZ.offlineVideoData,t_=void 0,((t_=AL)==null?0:t_.videoId)&&Z.set(AL.videoId,AL);HZ=new Map;lN=[];if((G=r)==null?0:(P=G.videos)==null?0:P.length)for(l=g.h(r.videos),U=l.next();!U.done;U=l.next())if(S=U.value,Zg=JSON.parse(g.r8(S).entityId),MO=Zg.videoId)Z.has(MO)?
(HZ.set(MO,Z.get(MO)),Z.delete(MO)):lN.push(MO);OC=Number((($Z=M.actionMetadata)==null?void 0:$Z.priority)||0)+1;GK=g.h(Z.entries());for(r0=GK.next();!r0.done;r0=GK.next())Zj=r0.value,jG=g.h(Zj),Wy=jG.next().value,XV=jG.next().value,s9=Wy,wp=XV,Oo.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",s9,"mainVideoEntity",OC,sV,jFH(M,wp,O)));kF=g.h(HZ.entries());for(u3=kF.next();!u3.done;u3=kF.next())Gj=u3.value,hy=g.h(Gj),PV=hy.next().value,St=hy.next().value,fb=PV,mK=St,Oo.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
fb,"mainVideoEntity",OC,sV,jFH(M,mK,O)));Ct=g.h(lN);for(sK=Ct.next();!sK.done;sK=Ct.next())o0=sK.value,mr={playlistId:O},SQ={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:mr},Oo.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",o0,"mainVideoEntity",0,sV,SQ));return $o.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,Oo))}})},gPN=function(B,M){var q,D,O,C;
return g.I(function(K){switch(K.C){case 1:return q=EV(M),g.kZ(K,2),D=g.r8(M.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.V(K,y2u(B.C,M,B.B,(O=M.actionMetadata)==null?void 0:(C=O.offlineLoggingData)==null?void 0:C.offlineDeleteReason),5):g.V(K,$cN(D,B.C,M,B.B),6);case 6:if(!B.pR.G("woffle_enable_main_downloads_library")){K.ZX(5);break}return g.V(K,VFT(B.C,M.entityKey),5);case 5:g.nZ(K,3);break;case 2:return g.d0(K),K.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},ZNM=function(B,M,q,D){var O,C,K,E,v,F,b;
return g.I(function(u){switch(u.C){case 1:return g.V(u,tFN([M]),2);case 2:return O=u.T,g.V(u,dAr(B,O[0],q,D),3);case 3:return C=u.T,K=C.mainPlaylistEntity,E=C.wyr,F=Nzx(K,(v=E)==null?void 0:v.avatar),g.kZ(u,4),g.V(u,YB(F),6);case 6:g.nZ(u,5);break;case 4:b=g.d0(u),b instanceof Error&&b.message==="Failed to fetch"&&DK(b.message);case 5:return u.return(O[0].videos)}})},dAr=function(B,M,q,D){var O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W;
return g.I(function(t){switch(t.C){case 1:O=Date.now().toString();q||(q=O);C=M.videos;K=M.playlistId;E=[];v=[];if(C)for(F=g.h(C),b=F.next();!b.done;b=F.next()){u=b.value;J=u.offlineVideoData;if(!J||!J.videoId)throw DK("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");A=J.videoId;N={videoId:A,playlistId:K};y={id:g.x6(JSON.stringify(N),"mainPlaylistVideoEntity"),video:g.x6(A,"mainVideoEntity")};E.push(y);v.push(y.id)}m={key:g.x6(K,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:q,lastSyncedTimestampMillis:O};n={key:g.x6(K,"mainPlaylistEntity"),playlistId:K,videos:v,title:M.title,thumbnailStyleData:GWu(M),visibility:PYM(M),downloadState:m.key};M.channel&&(d=M.channel.offlineChannelData,k=lbT(g.x6(K,"ytMainChannelEntity"),d),n.channelOwner=k.id);((W=n)==null?0:W.entityMetadata)?(n.entityMetadata.offlineLastModifiedTimestampSeconds=M.lastModifiedTimestamp,D&&(n.entityMetadata.nextAutoRefreshIntervalSeconds=String(D))):n&&(n.entityMetadata={nextAutoRefreshIntervalSeconds:D?
String(D):void 0,offlineLastModifiedTimestampSeconds:M.lastModifiedTimestamp});g.kZ(t,2);return g.V(t,Re(B.C,{mode:"readwrite",GR:!0},function(w){var L=Tk(w,n,"mainPlaylistEntity"),qO=Tk(w,m,"mainPlaylistDownloadStateEntity");L=[L,qO];qO=g.h(E);for(var Dg=qO.next();!Dg.done;Dg=qO.next())L.push(Tk(w,Dg.value,"mainPlaylistVideoEntity"));k&&L.push(Tk(w,k,"ytMainChannelEntity"));return g.kI.all(L)}),4);
case 4:g.nZ(t,3);break;case 2:throw g.d0(t),DK("PES failure for playlist"),Error("PES failure for playlist");case 3:return t.return({mainPlaylistEntity:n,wyr:k,c4Y:E})}})},lbT=function(B,M){return{id:B,
channelId:M.channelId,title:M.title,avatar:M.thumbnail}},GWu=function(B){var M=[],q=B.videos;
q&&q.length>0&&M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:q[0].offlineVideoData.thumbnail}}});if((B=B.additionalMetadadatas)&&B.length>0)for(B=g.h(B),q=B.next();!q.done;q=B.next()){var D=q.value.offlineBundleItemPlaylistData,O=void 0;q=(O=D)==null?void 0:O.style;O=void 0;D={collageThumbnail:{coverThumbnail:(O=D)==null?void 0:O.coverThumbnail}};switch(q){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:D});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:D});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:D});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:D})}}return M},PYM=function(B){switch(B.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},jFH=function(B,M,q){M={offlineVideoData:M,
playlistId:q};if(B=g.c(B.actionMetadata,nPM))M.maximumDownloadQuality=B.maximumDownloadQuality;return{mainVideoEntityActionMetadata:M}},IbY=function(B,M,q){this.C=B;
this.pR=M;this.B=q},HNZ=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N;
return g.I(function(y){switch(y.C){case 1:return q=EV(M),D=g.r8(M.entityKey),O=D.entityId,C=g.c(M.actionMetadata,Rc),E=!((K=C)==null?0:K.playlistId),g.kZ(y,2),g.V(y,Wgu(B,O,void 0,(v=C)==null?void 0:v.offlineVideoData,E),4);case 4:g.nZ(y,3);break;case 2:return F=g.d0(y),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.Af&&F.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
y.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,b,u));case 3:J=1;J=Number(((A=M.actionMetadata)==null?void 0:A.priority)||0)+1;var k=(k=g.c(M.actionMetadata,Rc))?{playbackDataActionMetadata:{maximumDownloadQuality:k.maximumDownloadQuality}}:void 0;N=lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O,"playbackData",J,QFo,k);return y.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,[N]))}})},UAr=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n;
return g.I(function(d){switch(d.C){case 1:return q=EV(M),D=g.r8(M.entityKey),O=D.entityId,g.V(d,ro(B.C,M.entityKey,"mainVideoEntity"),2);case 2:C=d.T;if(!C){K=void 0;d.ZX(3);break}return g.V(d,ro(B.C,C.downloadState,"mainVideoDownloadStateEntity"),4);case 4:K=d.T;case 3:E=K;if(!C||!E)return d.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));g.kZ(d,5);return g.V(d,Wgu(B,O,E.addedTimestampMillis,(F=g.c(M.actionMetadata,Rc))==null?void 0:F.offlineVideoData),7);case 7:b=1;b=Number(((u=
M.actionMetadata)==null?void 0:u.priority)||0)+1;v=lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O,"playbackData",b,QFo);g.nZ(d,6);break;case 5:J=g.d0(d);if(!(J instanceof Error&&J.message==="No data")){if(J instanceof Error&&J.message==="Empty response body")DK(J.message);else return A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.Af&&J.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),d.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,A,N));d.ZX(6);break}return g.V(d,j$(B.C,O),9);case 9:y=d.T;k=g.c(M.actionMetadata,Rc);if(n=(m=k)==null?void 0:m.playlistId)y.playlistId=n;y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.V(d,kB(O,B.C,M,B.B,y),6);case 6:return d.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,v?[v]:void 0))}})},tQL=function(B,M){var q,D,O,C,K,E,v,F,b,u;
return g.I(function(J){switch(J.C){case 1:return q=EV(M),g.kZ(J,2),D=g.r8(M.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.V(J,y2u(B.C,M,B.B,(b=M.actionMetadata)==null?void 0:(u=b.offlineLoggingData)==null?void 0:u.offlineDeleteReason),5):g.V(J,j$(B.C,D),6);case 6:O=J.T;C=g.c(M.actionMetadata,Rc);if(E=(K=C)==null?void 0:K.playlistId)O.playlistId=E;O.offlineDeleteReason=(v=M.actionMetadata)==null?void 0:(F=v.offlineLoggingData)==null?void 0:F.offlineDeleteReason;return g.V(J,kB(D,B.C,M,B.B,O),7);
case 7:if(!B.pR.G("woffle_enable_main_downloads_library")){J.ZX(5);break}return g.V(J,VFT(B.C,M.entityKey),5);case 5:g.nZ(J,3);break;case 2:return g.d0(J),J.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q))}})},Wgu=function(B,M,q,D,O){var C,K,E,v,F,b;
return g.I(function(u){switch(u.C){case 1:if(C=D){u.ZX(2);break}return g.V(u,UcL([M]),3);case 3:K=u.T,C=K[0];case 2:return g.V(u,pRY(B,C,q,O),4);case 4:E=u.T;v=E.mainVideoEntity;F=E.channelEntity;g.kZ(u,5);var J=NK(v.thumbnail),A=NK(F.avatar);return g.V(u,YB(J.concat(A)),7);case 7:g.nZ(u,0);break;case 5:b=g.d0(u),b instanceof Error&&b.message==="Failed to fetch"&&DK(b.message),g.YZ(u)}})},pRY=function(B,M,q,D){var O,C,K,E,v,F,b,u,J,A,N,y,k;
return g.I(function(m){switch(m.C){case 1:q||(q=Date.now().toString());C=(O=M.channel)==null?void 0:O.offlineChannelData;K={id:g.x6(M.videoId,"ytMainChannelEntity"),channelId:C.channelId,title:C.title,avatar:C.thumbnail};E={key:g.x6(M.videoId,"mainVideoDownloadStateEntity"),playbackData:g.x6(M.videoId,"playbackData"),addedTimestampMillis:q,videoDownloadContextEntity:g.x6(M.videoId,"videoDownloadContextEntity")};v={key:g.x6(M.videoId,"videoPlaybackPositionEntity"),videoId:M.videoId,lastPlaybackPositionSeconds:"0"};
B.pR.G("html5_offline_playback_position_sync")&&(F={playbackPosition:v.key});b=g.x6(M.videoId,"mainVideoEntity");u={key:b,videoId:M.videoId,title:M.title,thumbnail:M.thumbnail,localizedStrings:{viewCount:M.shortViewCountText},userState:F,lengthSeconds:M.lengthSeconds?Number(M.lengthSeconds):void 0,publishedTimestampMillis:M.publishedTimestamp?(Number(M.publishedTimestamp)*1E3).toString():void 0,formattedDescription:M.description,owner:K.id,downloadState:E.key};if(!B.pR.G("woffle_enable_main_downloads_library")||
!D){m.ZX(2);break}return g.V(m,mcx(B.C,[b]),3);case 3:if(N=m.T)J=N.mainDownloadsLibraryEntity,A=N.mainDownloadsListEntity;case 2:return k=vsd,y={key:g.x6(M.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.pE(E,k,y),g.V(m,Re(B.C,{mode:"readwrite",GR:!0},function(n){var d=Tk(n,K,"ytMainChannelEntity"),W=Tk(n,E,"mainVideoDownloadStateEntity"),t=Tk(n,u,"mainVideoEntity");d=[d,W,t];B.pR.G("html5_offline_playback_position_sync")&&(W=Tk(n,v,"videoPlaybackPositionEntity"),
d.push(W));J&&(W=Tk(n,J,"mainDownloadsLibraryEntity"),d.push(W));A&&(W=Tk(n,A,"mainDownloadsListEntity"),d.push(W));y&&(n=Tk(n,y,"downloadStatusEntity"),d.push(n));return g.kI.all(d)}),4);
case 4:return m.return({mainVideoEntity:u,channelEntity:K})}})},c3r=function(B,M,q){this.C=B;
this.pR=M;this.B=q},fbo=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r;
return g.I(function(NO){switch(NO.C){case 1:return q=EV(M),D=[],g.V(NO,Uu.getInstance(),2);case 2:O=NO.T;if(!O){NO.ZX(3);break}return g.V(NO,O.get("sdois"),4);case 4:return C=NO.T,g.V(NO,(E=O)==null?void 0:E.get("lmqf"),5);case 5:K=NO.T;case 3:g.kZ(NO,6);if(C===void 0)throw Error("prefStorage or opt-in state is undefined");v=[];if(C){NO.ZX(8);break}return g.V(NO,jbu(B.C),9);case 9:v=NO.T,v.reverse();case 8:if(!v.length){NO.ZX(10);break}F=g.h(v);b=F.next();case 11:if(b.done){NO.ZX(10);break}u=b.value;
if(!u){NO.ZX(12);break}J=g.r8(u).entityId;return g.V(NO,j$(B.C,J),14);case 14:return A=NO.T,A.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.V(NO,kB(J,B.C,{entityKey:u,actionType:M.actionType},B.B,A),12);case 12:b=F.next();NO.ZX(11);break;case 10:return g.V(NO,f0H(C,(N=K)!=null?N:"SD"),16);case 16:return y=NO.T,g.V(NO,Yxx(y),17);case 17:k=ZPd(y);if(!B.pR.G("woffle_enable_main_downloads_library")){NO.ZX(18);break}if(C){NO.ZX(19);break}return g.V(NO,VFT(B.C,g.Gi),19);case 19:return g.V(NO,
nsu(B.C,[g.Gi]),18);case 18:if((m=k)==null?0:m.length)for(n=g.h(k),d=n.next();!d.done;d=n.next())if(t=W=d.value,w=t.actionType,L=t.entityKey,qO=t.actionMetadata,w&&L&&qO&&!g.c(qO,SJZ)){w==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(qO.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Dg=g.c(W.actionMetadata,Rc))Dg.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",W.actionMetadata=Object.assign({},W.actionMetadata,{mainVideoEntityActionMetadata:Dg});D.push(W)}g.nZ(NO,
7);break;case 6:return x=g.d0(NO),A_="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.Af&&x.type==="QUOTA_EXCEEDED"&&(A_="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),NO.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,A_,r));case 7:return NO.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,D))}})},Tko=function(){XY.apply(this,
arguments);
this.U="mainVideoEntity"},Lgo=function(B,M,q){M=M===void 0?43200:M;
q=q===void 0?!0:q;var D=D===void 0?!1:D;var O,C,K;return g.I(function(E){switch(E.C){case 1:if(!B.K.cF())return E.return([]);O=[];g.kZ(E,2);return g.V(E,c2M(M,q,D),4);case 4:O=E.T;g.nZ(E,3);break;case 2:C=g.d0(E),C instanceof Error&&C.message==="No data"||C instanceof Error&&C.message==="Empty response body"&&DK(C.message);case 3:return K=y3x(B,O,q,"mainPlaylistEntity"),E.return(K)}})},XRT=function(B,M,q,D){D=D===void 0?!1:D;
var O,C,K,E,v,F,b,u,J,A,N,y,k,m,n;return g.I(function(d){switch(d.C){case 1:return O=[],g.V(d,Sxe(),2);case 2:return(C=d.T)||D?g.V(d,Tzx(M,q),3):d.return([]);case 3:K=d.T;if((E=K)==null||!E.length)return d.return([]);v={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};F=g.h(K);b=F.next();case 4:if(b.done){d.ZX(6);break}J=u=b.value;A=J.actionType;N=J.entityKey;y=J.actionMetadata;if(!(A&&N&&y)||g.c(y,SJZ)){d.ZX(5);break}A==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(y.offlineLoggingData=
v);k=g.r8(N);m=k.entityId;return g.V(d,w3(B,[m],"mainVideoEntity",A,y),8);case 8:n=d.T,O=O.concat(n);case 5:b=F.next();d.ZX(4);break;case 6:return d.return(O)}})},wRH=function(B,M){this.C=B;
this.B=M},R2o=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m;
return g.I(function(n){switch(n.C){case 1:return q=EV(M),D=g.r8(M.entityKey),O=D.entityId,C=[],g.kZ(n,2),g.V(n,sFH(B,O),4);case 4:C=n.T;if((K=C)==null||!K.length){n.ZX(5);break}return g.V(n,l0r(B.C,M.entityKey),5);case 5:g.nZ(n,3);break;case 2:return E=g.d0(n),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.Af&&E.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
n.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,v,F));case 3:return b=[],g.V(n,FrH(B.C,"musicTrack",C),7);case 7:C=n.T;if(C.length)for(u=g.h(C),J=u.next();!J.done;J=u.next())if(A=J.value,N=A.offlineVideoData,y=void 0,(y=N)==null?0:y.videoId)k=void 0,m=Number(((k=M.actionMetadata)==null?void 0:k.priority)||0)+1,b.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N.videoId,"musicTrack",m,iD,g3(M,N,O)));return n.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,b))}})},
iNN=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r,NO,Vr,fZ,mT,bN,g0,mm,Oo,Z,e1,Rt,Zf,PZ,AL,t_,HZ,lN,G,P,l,U,S,Zg,MO,$Z,OC,GK,r0,Zj,jG,Wy,XV;
return g.I(function(s9){switch(s9.C){case 1:return q=EV(M),D=M.entityKey,O=g.r8(D).entityId,C=[],K=!1,O==="!*$_ALL_ENTITIES_!*$"?(K=!0,g.V(s9,xw(B.C,"musicAlbumRelease"),5)):g.V(s9,ro(B.C,D,"musicAlbumRelease"),4);case 4:(E=s9.T)&&C.push(E);s9.ZX(3);break;case 5:C=s9.T;case 3:if((v=C)==null||!v.length)return s9.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));if(K){F=[];b=g.h(C);for(u=b.next();!u.done;u=b.next())J=u.value,A=g.r8(J.id).entityId,F.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
A,"musicAlbumRelease",0,iD));return s9.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,F))}N=[];y=C[0];k=void 0;if(!y.downloadMetadata){s9.ZX(6);break}return g.V(s9,ro(B.C,y.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:m=s9.T,k=Number((d=(n=m)==null?void 0:n.addedTimestampMillis)!=null?d:"0")/1E3;case 6:return g.kZ(s9,8),g.V(s9,sFH(B,O,(W=k)==null?void 0:W.toString()),10);case 10:N=s9.T;g.nZ(s9,9);break;case 8:t=g.d0(s9);if(!(t instanceof Error&&t.message===
"No data")){if(t instanceof Error&&t.message==="Empty response body")DK(t.message);else return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.Af&&t.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),s9.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,w,L));s9.ZX(9);break}return g.V(s9,n$(O,"musicAlbumRelease",B.C,
M,B.B),9);case 9:qO=[];Dg=new Map;if((x=N)==null?0:x.length)for(A_=g.h(N),r=A_.next();!r.done;r=A_.next())NO=r.value,Vr=NO.offlineVideoData,fZ=void 0,((fZ=Vr)==null?0:fZ.videoId)&&Dg.set(Vr.videoId,Vr);mT=new Map;bN=[];if((g0=y)==null?0:(mm=g0.tracks)==null?0:mm.length)for(Oo=g.h(y.tracks),Z=Oo.next();!Z.done;Z=Oo.next())if(e1=Z.value,Rt=g.r8(e1).entityId)Dg.has(Rt)?(mT.set(Rt,Dg.get(Rt)),Dg.delete(Rt)):bN.push(Rt);PZ=Number(((Zf=M.actionMetadata)==null?void 0:Zf.priority)||0)+1;AL=g.h(Dg.entries());
for(t_=AL.next();!t_.done;t_=AL.next())HZ=t_.value,lN=g.h(HZ),G=lN.next().value,P=lN.next().value,l=G,U=P,qO.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",l,"musicTrack",PZ,iD,g3(M,U)));S=g.h(mT.entries());for(Zg=S.next();!Zg.done;Zg=S.next())MO=Zg.value,$Z=g.h(MO),OC=$Z.next().value,GK=$Z.next().value,r0=OC,Zj=GK,qO.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",r0,"musicTrack",PZ,iD,g3(M,Zj)));jG=g.h(bN);for(Wy=jG.next();!Wy.done;Wy=jG.next())XV=Wy.value,qO.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
XV,"musicTrack",0,iD));return s9.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,qO))}})},r3Z=function(B,M){var q,D;
return g.I(function(O){switch(O.C){case 1:return q=EV(M),g.kZ(O,2),D=g.r8(M.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.V(O,VQ(B.C,M,B.B),5):g.V(O,n$(D,"musicAlbumRelease",B.C,M,B.B),6);case 6:return g.V(O,I0M(B.C,M.entityKey),5);case 5:g.nZ(O,3);break;case 2:return g.d0(O),O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},sFH=function(B,M,q){var D,O,C;
return g.I(function(K){switch(K.C){case 1:return g.V(K,tFN([M]),2);case 2:return D=K.T,g.V(K,xAL(B,D[0],q),3);case 3:return O=K.T,C=NK(O.thumbnailDetails),g.V(K,YB(C),4);case 4:return K.return(D[0].videos)}})},xAL=function(B,M,q){var D,O,C,K,E,v,F,b,u,J,A,N,y,k;
return g.I(function(m){if(m.C==1){D=M.additionalMetadadatas;O=void 0;if(D&&D.length>0)for(C=g.h(D),K=C.next();!K.done;K=C.next())if(E=K.value,E.offlineMusicPlaylistData){O=E.offlineMusicPlaylistData;break}v=M.playlistId;F=Wrr(M);b=F.BR;u=F.T$;J=q?(Number(q)*1E3).toString():Date.now().toString();A=M.lastModifiedTimestamp?(Number(M.lastModifiedTimestamp)*1E3).toString():"0";N={id:g.x6(v,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:u,lastModifiedTimestampMillis:A,addedTimestampMillis:J,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};y={id:g.x6(v,"musicAlbumRelease"),title:M.title,audioPlaylistId:v,trackCount:M.totalVideoCount,tracks:b,downloadMetadata:N.id};O&&(y.thumbnailDetails=(k=O.albumHqThumbnail)!=null?k:O.albumArtistThumbnail,y.artistDisplayName=O.albumArtistDisplayName,y.releaseDate=O.albumReleaseDate,y.contentRating={explicitType:O.albumReleaseExplicitType},y.releaseType=O.albumReleaseType);return g.V(m,Re(B.C,{mode:"readwrite",GR:!0},function(n){var d=Tk(n,y,"musicAlbumRelease");
n=Tk(n,N,"musicAlbumReleaseDownloadMetadataEntity");return g.kI.all([d,n])}),2)}return m.return(y)})},abT=function(B,M){this.C=B;
this.B=M},MNe=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m;
return g.I(function(n){switch(n.C){case 1:return q=EV(M),D=g.r8(M.entityKey),O=D.entityId,C=[],g.kZ(n,2),g.V(n,Bbr(B,O),4);case 4:C=n.T;if((K=C)==null||!K.length){n.ZX(5);break}return g.V(n,l0r(B.C,M.entityKey),5);case 5:g.nZ(n,3);break;case 2:return E=g.d0(n),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.Af&&E.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
n.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,v,F));case 3:return b=[],g.V(n,FrH(B.C,"musicTrack",C),7);case 7:C=n.T;if(C.length)for(u=g.h(C),J=u.next();!J.done;J=u.next())if(A=J.value,N=A.offlineVideoData,y=void 0,(y=N)==null?0:y.videoId)k=void 0,m=Number(((k=M.actionMetadata)==null?void 0:k.priority)||0)+1,b.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N.videoId,"musicTrack",m,r3,g3(M,N,O)));return n.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,b))}})},
qnL=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r,NO,Vr,fZ,mT,bN,g0,mm,Oo,Z,e1,Rt,Zf,PZ,AL,t_,HZ,lN,G,P,l,U,S,Zg,MO,$Z,OC,GK,r0,Zj,jG,Wy,XV,s9,wp,kF,u3,Gj,hy,PV,St,fb,mK,Ct,sK;
return g.I(function(o0){switch(o0.C){case 1:return q=EV(M),D=M.entityKey,O=g.r8(D).entityId,C=[],K=!1,O==="!*$_ALL_ENTITIES_!*$"?(K=!0,g.V(o0,xw(B.C,"musicPlaylist"),5)):g.V(o0,ro(B.C,D,"musicPlaylist"),4);case 4:(E=o0.T)&&C.push(E);o0.ZX(3);break;case 5:C=o0.T;case 3:if((v=C)==null||!v.length)return o0.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));F=g.c(M.actionMetadata,Qbo);u=(b=F)==null?void 0:b.autoSync;J=[];N=A=!0;y=!1;k=void 0;if(!K&&u===!1){o0.ZX(6);break}g.kZ(o0,7);return g.V(o0,
Lrj(0,!!u,!0,C),9);case 9:J=o0.T;g.nZ(o0,8);break;case 7:m=g.d0(o0);if(!(m instanceof Error&&m.message==="No data")){m instanceof Error&&m.message==="Empty response body"&&DK(m.message);o0.ZX(8);break}return O==="!*$_ALL_ENTITIES_!*$"?g.V(o0,VQ(B.C,M,B.B),8):g.V(o0,n$(O,"musicPlaylist",B.C,M,B.B),8);case 8:if(!J.length||!K&&J[0].playlistId!==O)return o0.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));case 6:if(K){n=[];d=g.h(J);for(W=d.next();!W.done;W=d.next())t=W.value,t.upToDate||
u&&!t.shouldAutoSyncMetadata||!t.playlistId||(w={autoSync:u},n.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t.playlistId,"musicPlaylist",0,r3,{musicPlaylistEntityActionMetadata:w})));return o0.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,n))}J.length&&(L=J[0],y=!!L.upToDate,u&&(A=(qO=L.shouldAutoSyncMetadata)!=null?qO:!0,N=(Dg=L.shouldAutoSyncVideos)!=null?Dg:!0,L.checkInSeconds&&(k=L.checkInSeconds)));if(y||!A)return o0.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q));x=[];A_=C[0];r=void 0;if(!A_.downloadMetadata){o0.ZX(15);break}return g.V(o0,ro(B.C,A_.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:NO=o0.T,r=Number((fZ=(Vr=NO)==null?void 0:Vr.addedTimestampMillis)!=null?fZ:"0")/1E3;case 15:return g.kZ(o0,17),g.V(o0,Bbr(B,O,(mT=r)==null?void 0:mT.toString(),k),19);case 19:x=o0.T;g.nZ(o0,18);break;case 17:bN=g.d0(o0);if(!(bN instanceof Error&&bN.message==="No data")){if(bN instanceof Error&&bN.message==="Empty response body")DK(bN.message);
else return g0="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",mm="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",bN instanceof g.Af&&bN.type==="QUOTA_EXCEEDED"&&(g0="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",mm="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),o0.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,g0,mm));o0.ZX(18);break}return g.V(o0,n$(O,"musicPlaylist",B.C,M,B.B),18);case 18:if(!N)return o0.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q));Oo=[];Z=new Map;if((e1=x)==null?0:e1.length)for(Rt=g.h(x),Zf=Rt.next();!Zf.done;Zf=Rt.next())PZ=Zf.value,AL=PZ.offlineVideoData,t_=void 0,((t_=AL)==null?0:t_.videoId)&&Z.set(AL.videoId,AL);HZ=new Map;lN=[];if((G=A_)==null?0:(P=G.tracks)==null?0:P.length)for(l=g.h(A_.tracks),U=l.next();!U.done;U=l.next())if(S=U.value,Zg=g.r8(S).entityId)Z.has(Zg)?(HZ.set(Zg,Z.get(Zg)),Z.delete(Zg)):lN.push(Zg);$Z=Number(((MO=M.actionMetadata)==null?void 0:MO.priority)||0)+1;OC=g.h(Z.entries());for(GK=OC.next();!GK.done;GK=
OC.next())r0=GK.value,Zj=g.h(r0),jG=Zj.next().value,Wy=Zj.next().value,XV=jG,s9=Wy,Oo.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",XV,"musicTrack",$Z,r3,g3(M,s9)));wp=g.h(HZ.entries());for(kF=wp.next();!kF.done;kF=wp.next())u3=kF.value,Gj=g.h(u3),hy=Gj.next().value,PV=Gj.next().value,St=hy,fb=PV,Oo.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",St,"musicTrack",$Z,r3,g3(M,fb)));mK=g.h(lN);for(Ct=mK.next();!Ct.done;Ct=mK.next())sK=Ct.value,Oo.push(lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
sK,"musicTrack",0,r3));return o0.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,Oo))}})},DXu=function(B,M){var q,D;
return g.I(function(O){switch(O.C){case 1:return q=EV(M),g.kZ(O,2),D=g.r8(M.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.V(O,VQ(B.C,M,B.B),5):g.V(O,n$(D,"musicPlaylist",B.C,M,B.B),6);case 6:return g.V(O,I0M(B.C,M.entityKey),5);case 5:g.nZ(O,3);break;case 2:return g.d0(O),O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},Bbr=function(B,M,q,D){var O,C,K;
return g.I(function(E){switch(E.C){case 1:return g.V(E,tFN([M]),2);case 2:return O=E.T,g.V(E,OUr(B,O[0],q,D),3);case 3:return C=E.T,K=NK(C.thumbnailDetails),g.V(E,YB(K),4);case 4:return E.return(O[0].videos)}})},OUr=function(B,M,q,D){var O,C,K,E,v,F,b,u,J;
return g.I(function(A){return A.C==1?(O=M.playlistId,C=Wrr(M),K=C.BR,E=C.T$,v=q?(Number(q)*1E3).toString():Date.now().toString(),F=M.lastModifiedTimestamp?(Number(M.lastModifiedTimestamp)*1E3).toString():"0",b={id:g.x6(O,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:E,lastModifiedTimestampMillis:F,addedTimestampMillis:v,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},u={id:g.x6(O,"musicPlaylist"),title:M.title,playlistId:O,thumbnailDetails:M.thumbnail,visibility:CBT(M),trackCount:M.totalVideoCount,
tracks:K,downloadMetadata:b.id},D&&(((J=u)==null?0:J.entityMetadata)?u.entityMetadata.nextAutoRefreshIntervalSeconds=String(D):u&&(u.entityMetadata={nextAutoRefreshIntervalSeconds:String(D)})),g.V(A,Re(B.C,{mode:"readwrite",GR:!0},function(N){var y=Tk(N,u,"musicPlaylist");N=Tk(N,b,"musicPlaylistDownloadMetadataEntity");return g.kI.all([y,N])}),2)):A.return(u)})},CBT=function(B){switch(B.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},K9x=function(B,M){this.C=B;
this.B=M},vyH=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N;
return g.I(function(y){switch(y.C){case 1:return q=EV(M),D=g.r8(M.entityKey),O=D.entityId,C=g.c(M.actionMetadata,ehe),g.kZ(y,2),g.V(y,oyr(B,O,void 0,(K=C)==null?void 0:K.track,(E=C)==null?void 0:E.albumRelease),4);case 4:if((v=C)==null?0:v.playlistId){y.ZX(5);break}return g.V(y,l0r(B.C,M.entityKey),5);case 5:g.nZ(y,3);break;case 2:return F=g.d0(y),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.Af&&F.type==="QUOTA_EXCEEDED"&&
(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),y.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,b,u));case 3:A=Number(((J=M.actionMetadata)==null?void 0:J.priority)||0)+1;var k=(k=g.c(M.actionMetadata,ehe))?{playbackDataActionMetadata:{maximumDownloadQuality:k.maximumDownloadQuality}}:void 0;N=lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O,"playbackData",A,Eyu,k);return y.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q,[N]))}})},F9M=function(B,M){var q,D,O,C,K,E,v,F,b,u,J,A,N,y,k;
return g.I(function(m){switch(m.C){case 1:return q=EV(M),D=g.r8(M.entityKey),O=D.entityId,g.V(m,ro(B.C,M.entityKey,"musicTrack"),2);case 2:C=m.T;if(!C){K=void 0;m.ZX(3);break}return g.V(m,ro(B.C,C.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:K=m.T;case 3:E=K;if(!C||!E)return m.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q));F=g.c(M.actionMetadata,ehe);g.kZ(m,5);return g.V(m,oyr(B,O,E.addedTimestampMillis,(b=F)==null?void 0:b.track,(u=F)==null?void 0:u.albumRelease),
7);case 7:A=Number(((J=M.actionMetadata)==null?void 0:J.priority)||0)+1;v=lD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O,"playbackData",A,Eyu);g.nZ(m,6);break;case 5:N=g.d0(m);if(!(N instanceof Error&&N.message==="No data")){if(N instanceof Error&&N.message==="Empty response body")DK(N.message);else return y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.Af&&N.type==="QUOTA_EXCEEDED"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,y,k));m.ZX(6);break}return g.V(m,mu(O,B.C,M,B.B),6);case 6:return m.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",q,v?[v]:void 0))}})},bUM=function(B,M){var q,D;
return g.I(function(O){switch(O.C){case 1:return q=EV(M),g.kZ(O,2),D=g.r8(M.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.V(O,VQ(B.C,M,B.B),5):g.V(O,mu(D,B.C,M,B.B),6);case 6:return g.V(O,I0M(B.C,M.entityKey),5);case 5:g.nZ(O,3);break;case 2:return g.d0(O),O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new Ic("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
q))}})},oyr=function(B,M,q,D,O){var C,K,E,v,F,b;
return g.I(function(u){switch(u.C){case 1:if(C=D){u.ZX(2);break}return g.V(u,UcL([M]),3);case 3:K=u.T,E=K[0],C=PxT(E);case 2:return g.V(u,uvH(B,C,M,O,q),4);case 4:v=u.T;F=v.musicTrackEntity;b=v.FO;var J=NK(F.thumbnailDetails),A=[];b&&(A=NK(b.thumbnailDetails));return g.V(u,YB(J.concat(A)),0)}})},uvH=function(B,M,q,D,O){var C;
return g.I(function(K){return K.C==1?(O||(O=Date.now().toString()),C={id:g.x6(q,"musicTrackDownloadMetadataEntity"),playbackData:g.x6(q,"playbackData"),addedTimestampMillis:O,videoDownloadContextEntity:g.x6(q,"videoDownloadContextEntity")},D&&(M.albumRelease=D.id),g.V(K,Re(B.C,{mode:"readwrite",GR:!0},function(E){var v=[],F=Tk(E,C,"musicTrackDownloadMetadataEntity");v.push(F);F=Tk(E,M,"musicTrack");v.push(F);D&&(E=Tk(E,D,"musicAlbumRelease"),v.push(E));return g.kI.all(v)}),2)):K.C!=3?g.V(K,uD(q,"musicTrackDownloadMetadataEntity",
B.C,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):K.return({musicTrackEntity:M,
FO:D})})},xB=function(){XY.apply(this,arguments);
this.U="musicTrack"},Jwe=function(B,M,q){M=M===void 0?43200:M;
q=q===void 0?!0:q;var D=D===void 0?!1:D;var O,C;return g.I(function(K){switch(K.C){case 1:if(!B.K.cF())return K.return([]);O=[];g.kZ(K,2);return g.V(K,Lrj(M,q,D),4);case 4:O=K.T;g.nZ(K,3);break;case 2:g.d0(K);case 3:return C=y3x(B,O,q,"musicPlaylist"),K.return(C)}})},AwM=function(){g.v_.apply(this,arguments);
var B=this;this.events=new g.td(this);this.pR=this.player.S();this.Wc={ux4:function(){return B.C},
lz:function(){return B.lz()},
VH:function(M){return B.VH(M)}}},Nbu=function(B){var M;
B=g.c((M=B.getWatchNextResponse())==null?void 0:M.currentVideoEndpoint,g.aU);if(B==null?0:B.playlistId)var q=B.playlistId;return q},zhL=function(B,M){var q,D,O,C;
return g.I(function(K){if(K.C==1){q=M.clientPlaybackNonce;D={cpn:q,offlineSourceVisualElement:g.k$(M.qG||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};M.T&&(D.videoFmt=Number(M.T.itag));M.W&&(D.audioFmt=Number(M.W.itag));if((O=Nbu(M))&&M.videoId){var E=M.videoId;E=O!=="PPSV"?Promise.resolve(!1):B.C.cH(E);K=g.V(K,E,3)}else K=K.ZX(2);return K}K.C!=2&&(C=K.T)&&(D.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");B.T=q;g.or("offlinePlaybackStarted",D);g.YZ(K)})};
g.gL.prototype.SW=g.KZ(51,function(B){return this.app.SW(B)});
g.F6.prototype.SW=g.KZ(50,function(B){return g.IBO(this,9,B)});
g.z(Q4,Wg);g.oh.Object.defineProperties(Q4.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.C.entityMetadata},
set:function(B){this.C.entityMetadata=B}}});
g.z(E2M,Q4);E2M.prototype.T=function(){return[]};
g.z(v2t,Q4);v2t.prototype.T=function(){return[]};
g.z(Fid,Q4);Fid.prototype.T=function(){return[]};
g.z(bhj,Q4);bhj.prototype.T=function(){return[]};
g.z(uAY,Q4);uAY.prototype.T=function(){var B=[];this.C.alternateChannel&&B.push(this.C.alternateChannel);this.C.alternateChannelList&&B.push.apply(B,g.Y(this.C.alternateChannelList));this.C.oneofChannelEntity&&B.push(this.C.oneofChannelEntity);return[].concat(g.Y(new Set(B)))};
g.z(Jcu,Q4);Jcu.prototype.T=function(){var B=[];this.C.entryCollection&&B.push(this.C.entryCollection);return[].concat(g.Y(new Set(B)))};
g.z(AcZ,Wg);AcZ.prototype.T=function(){var B=[];this.C.video&&B.push(this.C.video);return[].concat(g.Y(new Set(B)))};
g.z(Nyj,Q4);Nyj.prototype.T=function(){var B=[];this.C.parentPlaylist&&B.push(this.C.parentPlaylist);if(this.C.entries)for(var M=g.h(this.C.entries),q=M.next();!q.done;q=M.next())B.push.apply(B,g.Y((new AcZ(q.value)).T()));return[].concat(g.Y(new Set(B)))};
g.z(z1Y,Q4);z1Y.prototype.T=function(){var B=[];this.C.descriptionEntity&&B.push(this.C.descriptionEntity);this.C.creators&&B.push.apply(B,g.Y(this.C.creators));this.C.theBiggestFan&&B.push(this.C.theBiggestFan);return[].concat(g.Y(new Set(B)))};
g.z($Lt,Q4);$Lt.prototype.T=function(){return[]};
g.z(h1N,Q4);h1N.prototype.T=function(){return[]};
g.z(ycu,Q4);ycu.prototype.T=function(){return[]};
g.z(Ygd,Q4);Ygd.prototype.T=function(){return[]};
g.z(krZ,Q4);krZ.prototype.T=function(){return[]};
g.z(ZhY,Q4);ZhY.prototype.T=function(){return[]};
g.z(joL,Q4);joL.prototype.T=function(){return[]};
g.z(mLu,Q4);mLu.prototype.T=function(){return[]};
g.z(n2o,Q4);n2o.prototype.T=function(){return[]};
g.z(VZL,Q4);VZL.prototype.T=function(){var B=[];this.C.downloadsList&&B.push(this.C.downloadsList);this.C.smartDownloadsList&&B.push(this.C.smartDownloadsList);this.C.recommendedDownloadsList&&B.push(this.C.recommendedDownloadsList);this.C.refresh&&B.push(this.C.refresh);return[].concat(g.Y(new Set(B)))};
g.z(g2d,Wg);g2d.prototype.T=function(){var B=[];this.C.video&&B.push(this.C.video);this.C.playlist&&B.push(this.C.playlist);this.C.videoItem&&B.push(this.C.videoItem);this.C.playlistItem&&B.push(this.C.playlistItem);return[].concat(g.Y(new Set(B)))};
g.z(dLL,Q4);dLL.prototype.T=function(){var B=[];this.C.refresh&&B.push(this.C.refresh);if(this.C.downloads)for(var M=g.h(this.C.downloads),q=M.next();!q.done;q=M.next())B.push.apply(B,g.Y((new g2d(q.value)).T()));return[].concat(g.Y(new Set(B)))};
g.z(Grj,Q4);Grj.prototype.T=function(){var B=[];this.C.localImageEntities&&B.push.apply(B,g.Y(this.C.localImageEntities));return[].concat(g.Y(new Set(B)))};
g.z(PIt,Q4);PIt.prototype.T=function(){var B=[];this.C.playbackData&&B.push(this.C.playbackData);this.C.localImageEntities&&B.push.apply(B,g.Y(this.C.localImageEntities));this.C.videoDownloadContextEntity&&B.push(this.C.videoDownloadContextEntity);return[].concat(g.Y(new Set(B)))};
g.z(laT,Q4);laT.prototype.T=function(){return[]};
g.z(Iau,Q4);Iau.prototype.T=function(){var B=[];this.C.fakeChildren&&B.push.apply(B,g.Y(this.C.fakeChildren));return[].concat(g.Y(new Set(B)))};
g.z(WiZ,Q4);WiZ.prototype.T=function(){var B=[];this.C.video&&B.push(this.C.video);this.C.playbackData&&B.push(this.C.playbackData);this.C.offlineVideoPolicy&&B.push(this.C.offlineVideoPolicy);return[].concat(g.Y(new Set(B)))};
g.z(QoH,Q4);QoH.prototype.T=function(){return[]};
g.z(Hho,Q4);Hho.prototype.T=function(){var B=[];this.C.channelOwner&&B.push(this.C.channelOwner);this.C.videos&&B.push.apply(B,g.Y(this.C.videos));this.C.collaboratorChannels&&B.push.apply(B,g.Y(this.C.collaboratorChannels));this.C.downloadState&&B.push(this.C.downloadState);this.C.refresh&&B.push(this.C.refresh);return[].concat(g.Y(new Set(B)))};
g.z(ULu,Q4);ULu.prototype.T=function(){var B=[];this.C.video&&B.push(this.C.video);this.C.channelContributor&&B.push(this.C.channelContributor);return[].concat(g.Y(new Set(B)))};
g.z(tZH,Wg);tZH.prototype.T=function(){var B=[];this.C.localImageEntities&&B.push.apply(B,g.Y(this.C.localImageEntities));this.C.videoDownloadContextEntity&&B.push(this.C.videoDownloadContextEntity);return[].concat(g.Y(new Set(B)))};
g.z(pft,Wg);pft.prototype.T=function(){var B=[];this.C.recommendedVideoMetadata&&B.push.apply(B,g.Y((new tZH(this.C.recommendedVideoMetadata)).T()));return[].concat(g.Y(new Set(B)))};
g.z(ccZ,Wg);ccZ.prototype.T=function(){var B=[];this.C.playbackPosition&&B.push(this.C.playbackPosition);return[].concat(g.Y(new Set(B)))};
g.z(Sgu,Q4);Sgu.prototype.T=function(){var B=[];this.C.owner&&B.push(this.C.owner);this.C.downloadState&&B.push(this.C.downloadState);this.C.userState&&B.push.apply(B,g.Y((new ccZ(this.C.userState)).T()));this.C.additionalMetadata&&B.push.apply(B,g.Y((new pft(this.C.additionalMetadata)).T()));return[].concat(g.Y(new Set(B)))};
g.z(faL,Q4);faL.prototype.T=function(){var B=[];this.C.userChannelDetails&&B.push(this.C.userChannelDetails);return[].concat(g.Y(new Set(B)))};
g.z(Tyo,Q4);Tyo.prototype.T=function(){var B=[];this.C.channelOwner&&B.push(this.C.channelOwner);this.C.playbackPosition&&B.push(this.C.playbackPosition);this.C.localImageEntities&&B.push.apply(B,g.Y(this.C.localImageEntities));this.C.downloadStatus&&B.push(this.C.downloadStatus);return[].concat(g.Y(new Set(B)))};
g.z(LiM,Q4);LiM.prototype.T=function(){return[]};
g.z(XfT,Q4);XfT.prototype.T=function(){return[]};
g.z(wfu,Q4);wfu.prototype.T=function(){return[]};
g.z(sou,Q4);sou.prototype.T=function(){return[]};
g.z(R1Z,Q4);R1Z.prototype.T=function(){return[]};
g.z(iht,Q4);iht.prototype.T=function(){return[]};
g.z(rcu,Q4);rcu.prototype.T=function(){return[]};
g.z(xLY,Q4);xLY.prototype.T=function(){return[]};
g.z(aaN,Q4);aaN.prototype.T=function(){return[]};
g.z(B5T,Q4);B5T.prototype.T=function(){return[]};
g.z(M6M,Q4);M6M.prototype.T=function(){return[]};
g.z(qAY,Q4);qAY.prototype.T=function(){var B=[];this.C.trackDownloadMetadatas&&B.push.apply(B,g.Y(this.C.trackDownloadMetadatas));return[].concat(g.Y(new Set(B)))};
g.z(DVe,Q4);
DVe.prototype.T=function(){var B=[];this.C.downloadedTracks&&B.push.apply(B,g.Y(this.C.downloadedTracks));this.C.smartDownloadedTracks&&B.push.apply(B,g.Y(this.C.smartDownloadedTracks));this.C.downloadedEpisodes&&B.push.apply(B,g.Y(this.C.downloadedEpisodes));this.C.downloadedAlbumReleases&&B.push.apply(B,g.Y(this.C.downloadedAlbumReleases));this.C.smartDownloadedAlbumReleases&&B.push.apply(B,g.Y(this.C.smartDownloadedAlbumReleases));this.C.downloadedPlaylists&&B.push.apply(B,g.Y(this.C.downloadedPlaylists));this.C.smartDownloadedPlaylists&&
B.push.apply(B,g.Y(this.C.smartDownloadedPlaylists));this.C.metadataOnlyTracks&&B.push.apply(B,g.Y(this.C.metadataOnlyTracks));return[].concat(g.Y(new Set(B)))};
g.z(OyZ,Q4);OyZ.prototype.T=function(){var B=[];this.C.trackDownloadMetadatas&&B.push.apply(B,g.Y(this.C.trackDownloadMetadatas));return[].concat(g.Y(new Set(B)))};
g.z(CVZ,Q4);CVZ.prototype.T=function(){var B=[];this.C.playbackData&&B.push(this.C.playbackData);this.C.localImageEntities&&B.push.apply(B,g.Y(this.C.localImageEntities));this.C.videoDownloadContextEntity&&B.push(this.C.videoDownloadContextEntity);return[].concat(g.Y(new Set(B)))};
g.z(Ket,Q4);Ket.prototype.T=function(){var B=[];this.C.musicLibraryStatusEntity&&B.push(this.C.musicLibraryStatusEntity);this.C.primaryArtists&&B.push.apply(B,g.Y(this.C.primaryArtists));this.C.details&&B.push(this.C.details);this.C.userDetails&&B.push(this.C.userDetails);this.C.tracks&&B.push.apply(B,g.Y(this.C.tracks));this.C.share&&B.push(this.C.share);this.C.downloadMetadata&&B.push(this.C.downloadMetadata);this.C.refresh&&B.push(this.C.refresh);return[].concat(g.Y(new Set(B)))};
g.z(eaM,Q4);eaM.prototype.T=function(){var B=[];this.C.albumRelease&&B.push(this.C.albumRelease);this.C.tracks&&B.push.apply(B,g.Y(this.C.tracks));return[].concat(g.Y(new Set(B)))};
g.z(odZ,Q4);odZ.prototype.T=function(){var B=[];this.C.albumRelease&&B.push(this.C.albumRelease);return[].concat(g.Y(new Set(B)))};
g.z(EdL,Q4);EdL.prototype.T=function(){var B=[];this.C.details&&B.push(this.C.details);this.C.userDetails&&B.push(this.C.userDetails);return[].concat(g.Y(new Set(B)))};
g.z(vdu,Q4);vdu.prototype.T=function(){var B=[];this.C.parentArtist&&B.push(this.C.parentArtist);return[].concat(g.Y(new Set(B)))};
g.z(FeN,Q4);FeN.prototype.T=function(){var B=[];this.C.parentArtist&&B.push(this.C.parentArtist);return[].concat(g.Y(new Set(B)))};
g.z(byZ,Q4);byZ.prototype.T=function(){return[]};
g.z(uhr,Q4);uhr.prototype.T=function(){return[]};
g.z(JSx,Wg);JSx.prototype.T=function(){var B=[];this.C.creatorEntity&&B.push(this.C.creatorEntity);return[].concat(g.Y(new Set(B)))};
g.z(ASN,Q4);
ASN.prototype.T=function(){var B=[];this.C.tracks&&B.push.apply(B,g.Y(this.C.tracks));this.C.refresh&&B.push(this.C.refresh);this.C.musicLibraryStatusEntity&&B.push(this.C.musicLibraryStatusEntity);this.C.details&&B.push(this.C.details);this.C.downloadMetadata&&B.push(this.C.downloadMetadata);this.C.sideloadMetadata&&B.push(this.C.sideloadMetadata);this.C.userDetails&&B.push(this.C.userDetails);this.C.entryCollection&&B.push(this.C.entryCollection);this.C.share&&B.push(this.C.share);this.C.podcastShowAdditionalMetadata&&B.push.apply(B,
g.Y((new JSx(this.C.podcastShowAdditionalMetadata)).T()));return[].concat(g.Y(new Set(B)))};
g.z(N5t,Q4);N5t.prototype.T=function(){return[]};
g.z(zaL,Q4);
zaL.prototype.T=function(){var B=[];this.C.musicLibraryStatusEntity&&B.push(this.C.musicLibraryStatusEntity);this.C.artists&&B.push.apply(B,g.Y(this.C.artists));this.C.audioModeVersion&&B.push(this.C.audioModeVersion);this.C.videoModeVersion&&B.push(this.C.videoModeVersion);this.C.userDetails&&B.push(this.C.userDetails);this.C.details&&B.push(this.C.details);this.C.albumRelease&&B.push(this.C.albumRelease);this.C.share&&B.push(this.C.share);this.C.libraryEdit&&B.push(this.C.libraryEdit);this.C.downloadMetadata&&
B.push(this.C.downloadMetadata);this.C.playbackPosition&&B.push(this.C.playbackPosition);this.C.lyrics&&B.push(this.C.lyrics);return[].concat(g.Y(new Set(B)))};
g.z($VH,Q4);$VH.prototype.T=function(){var B=[];this.C.parentTrack&&B.push(this.C.parentTrack);return[].concat(g.Y(new Set(B)))};
g.z(hao,Q4);hao.prototype.T=function(){var B=[];this.C.parentTrack&&B.push(this.C.parentTrack);return[].concat(g.Y(new Set(B)))};
g.z(ySr,Q4);ySr.prototype.T=function(){return[]};
g.z(YAj,Q4);YAj.prototype.T=function(){return[]};
g.z(kmd,Q4);kmd.prototype.T=function(){return[]};
g.z(ZyT,Q4);ZyT.prototype.T=function(){return[]};
g.z(jpL,Q4);jpL.prototype.T=function(){var B=[];this.C.transfer&&B.push(this.C.transfer);this.C.adsPlaybackData&&B.push.apply(B,g.Y(this.C.adsPlaybackData));this.C.drmLicense&&B.push(this.C.drmLicense);this.C.offlineVideoPolicy&&B.push(this.C.offlineVideoPolicy);this.C.videoDownloadContextEntity&&B.push(this.C.videoDownloadContextEntity);return[].concat(g.Y(new Set(B)))};
g.z(mVT,Q4);mVT.prototype.T=function(){return[]};
g.z(ndH,Q4);ndH.prototype.T=function(){var B=[];this.C.offlineVideoStreams&&B.push.apply(B,g.Y(this.C.offlineVideoStreams));this.C.captionTrack&&B.push.apply(B,g.Y(this.C.captionTrack));return[].concat(g.Y(new Set(B)))};
g.z(V6x,Q4);V6x.prototype.T=function(){return[]};
g.z(gdY,Q4);gdY.prototype.T=function(){return[]};
g.z(dVT,Q4);dVT.prototype.T=function(){return[]};
g.z(Gmd,Q4);Gmd.prototype.T=function(){return[]};
g.z(PVo,Q4);PVo.prototype.T=function(){return[]};
g.z(lpu,Q4);lpu.prototype.T=function(){return[]};
g.z(Ipt,Q4);Ipt.prototype.T=function(){return[]};
g.z(Wej,Q4);Wej.prototype.T=function(){return[]};
g.z(QpM,Q4);QpM.prototype.T=function(){return[]};
g.z(HyM,Q4);HyM.prototype.T=function(){return[]};
g.z(UVt,Q4);UVt.prototype.T=function(){return[]};
g.z(t6t,Q4);t6t.prototype.T=function(){return[]};
g.z(p2d,Q4);p2d.prototype.T=function(){return[]};
g.z(cSu,Q4);cSu.prototype.T=function(){return[]};
g.z(SAj,Q4);SAj.prototype.T=function(){return[]};
g.z(fpL,Q4);fpL.prototype.T=function(){return[]};
g.z(T5d,Q4);T5d.prototype.T=function(){return[]};
g.z(LeM,Q4);LeM.prototype.T=function(){return[]};
g.z(X2x,Q4);X2x.prototype.T=function(){return[]};
g.z(w2u,Q4);w2u.prototype.T=function(){return[]};
var XML=["browse","music/browse","unplugged/browse"],r2N=["offline/playlist_sync_check"],HPu=["offline"],wMT=["offline/offline_video_playback_position_sync"],R6N=["offline/get_playback_data_entity"],Hg;Uu.getInstance=function(){return g.I(function(B){return B.return(new Promise(function(M){g.iP().then(function(q){q?(Uu.instance||(Uu.instance=new Uu(q)),M(Uu.instance)):M(void 0)})}))})};
Uu.prototype.get=function(B){var M=this,q,D,O;return g.I(function(C){if(C.C==1)return g.V(C,rSr(M.token),2);if(C.C!=3)return q=C.T,g.V(C,q.get("prefs",B),3);D=C.T;if(!D)return C.return();O=(0,g.f)();return D.expirationTimestampMs<=O?C.return():C.return(D.value)})};
Uu.prototype.set=function(B,M,q){q=q===void 0?31536E3:q;var D=this,O,C,K;return g.I(function(E){if(E.C==1)return O=(0,g.f)(),C={key:B,value:M,expirationTimestampMs:O+q*1E3},g.V(E,rSr(D.token),2);K=E.T;return g.V(E,g.Pw(K,"prefs",C),0)})};
Uu.prototype.remove=function(B){var M=this,q;return g.I(function(D){if(D.C==1)return g.V(D,rSr(M.token),2);q=D.T;return g.V(D,q.delete("prefs",B),0)})};
g.z(ta,g.XU);g.z(pS,qee);pS.prototype.B=function(B,M){M=OKY(M);B=(new TextEncoder).encode(JSON.stringify(B));return this.C.encrypt(B,M)};
pS.prototype.T=function(B,M){if(!(B instanceof Uint8Array))throw xVL(1);var q=new TextDecoder;M=OKY(M);B=this.C.decrypt(B,M);return JSON.parse(q.decode(B))};
var Chj={accountLinkStatusEntity:ycu,booleanEntity:Fid,buttonEntity:p2d,captionTrack:ySr,channelHandle:E2M,commerceAcquisitionClientPayloadEntity:SAj,commerceCartListEntity:fpL,contextNoteFeedEntityPayload:v2t,continuationTokenEntity:QoH,downloadQualityPickerEntity:joL,downloadsPageRefreshTokenEntity:n2o,downloadsPageViewConfigurationEntity:LiM,downloadStatusEntity:mLu,dismissState:Ipt,sfvAudioItemCurrentlyPlayingEntity:Gmd,emojiFountainDataEntity:UVt,emojiCustomizationSetEntity:HyM,fakeChannel:uAY,
fakePlaylist:Jcu,fakePlaylistEntryCollection:Nyj,fakeVideo:z1Y,fakeVideoDescription:$Lt,featuredProductsEntity:aaN,flowStateEntity:h1N,iconBadgeEntity:T5d,interstitialInteractionStateEntity:krZ,likeButtonAnimationEntity:XfT,liveChatPollStateEntity:ZhY,liveViewerLeaderboardChatEntryPointStateEntity:gdY,liveViewerLeaderboardPointsEntity:dVT,liveReactionsDataEntity:t6t,logoEntity:Ygd,macroMarkerEntity:wfu,mainDownloadsLibraryEntity:VZL,mainDownloadsListEntity:dLL,mainPlaylistDownloadStateEntity:Grj,
mainPlaylistEntity:Hho,mainPlaylistVideoEntity:ULu,mainVideoDownloadStateEntity:PIt,mainVideoEntity:Sgu,markersEngagementPanelSyncEntity:sou,markersVisibilityOverrideEntity:R1Z,musicAlbumReleaseDetail:eaM,musicAlbumReleaseDownloadMetadataEntity:qAY,musicAlbumRelease:Ket,musicAlbumReleaseUserDetail:odZ,musicArtistDetail:vdu,musicArtist:EdL,musicArtistUserDetail:FeN,musicDownloadsLibraryEntity:DVe,musicLibraryEdit:byZ,musicLibraryStatusEntity:uhr,musicPlaylist:ASN,musicPlaylistDownloadMetadataEntity:OyZ,
musicShare:N5t,musicTrackDetail:$VH,musicTrackDownloadMetadataEntity:CVZ,musicTrack:zaL,musicTrackUserDetail:hao,offlineOrchestrationActionWrapperEntity:YAj,offlineVideoPolicy:kmd,offlineVideoStreams:ZyT,offlineabilityEntity:laT,orchestrationWebSamplingEntity:Iau,pageHeaderEntity:Wej,pdpStateEntity:LeM,pinnedProductEntity:B5T,playbackData:jpL,playerStateEntity:iht,quantityIncrementerEntity:X2x,refresh:mVT,saveToPlaylistListEntity:PVo,settingEntity:lpu,stringEntity:bhj,suggestedFeedbackChipStateEntity:rcu,
transfer:ndH,trendingOfferEntity:M6M,videoDownloadContextEntity:V6x,videoOverviewAsyncDataEntity:w2u,videoPlaybackPositionEntity:cSu,votingEntity:QpM,ytMainChannelEntity:faL,youchatPendingResponseEntity:xLY,ytMainDownloadedVideoEntity:WiZ,ytMainVideoEntity:Tyo};g.z(Xs,qee);Xs.prototype.B=function(B){return B};
Xs.prototype.T=function(B){if(B instanceof Uint8Array)throw xVL(0);return B};
g.z(wo,g.H);wo.prototype.observe=function(B){var M=this;this.observers.push(B);return function(){var q=M.observers.indexOf(B);q>=0&&M.observers.splice(q,1)}};
wo.prototype.T=function(B){h$T(this,B.data)};
wo.prototype.eY=function(){this.channel.close()};
var j7d,k$u=new g.Zb("elementsCommand");var ZK=new g.Zb("entityBatchUpdate");var vsd=new g.Zb("downloadStatusEntity");var nPM=new g.Zb("mainPlaylistEntityActionMetadata");var Rc=new g.Zb("mainVideoEntityActionMetadata");var Qbo=new g.Zb("musicPlaylistEntityActionMetadata");var ehe=new g.Zb("musicTrackEntityActionMetadata");var SJZ=new g.Zb("localImageEntityActionMetadata");var Wp=new g.Zb("playbackDataActionMetadata");var Z7M=new g.Zb("transferEntityActionMetadata");var oVu=new g.Zb("videoPlaybackPositionEntityActionMetadata");var pcx;new g.vc;new g.vc;L3N.prototype.request=function(B,M,q){M=M===void 0?{}:M;return this.locks.request(B,M,function(D){return q(D)})};var qK=g.w0.caches,MK,iKM;Bp.prototype.open=function(B){return qK.open(s7x(B))};
Bp.prototype.has=function(B){return qK.has(s7x(B))};
Bp.prototype.delete=function(B){return qK.delete(s7x(B))};
Bp.prototype.match=function(B,M){var q=this,D,O,C,K,E,v;return g.I(function(F){switch(F.C){case 1:return g.V(F,q.keys(),2);case 2:D=F.T,O=g.h(D),C=O.next();case 3:if(C.done){F.ZX(5);break}K=C.value;return g.V(F,q.open(K),6);case 6:return E=F.T,g.V(F,E.match(B,M),7);case 7:if(v=F.T)return F.return(v);C=O.next();F.ZX(3);break;case 5:return F.return()}})};
g.z(wct,Bp);wct.prototype.keys=function(){var B,M,q,D,O,C,K,E,v;return g.I(function(F){if(F.C==1)return B=[],M=g.wM("CacheStorage keys"),g.V(F,qK.keys(),2);q=F.T;D=g.h(q);for(O=D.next();!O.done;O=D.next()){C=O.value;var b=C.indexOf(":");K=b===-1?{v$:C}:{v$:C.substring(0,b),datasyncId:C.substring(b+1)};E=K.v$;v=K.datasyncId;v===M&&B.push(E)}return F.return(B)})};g.z(OV,g.H);OV.prototype.B=function(B){this.api.EC("onOfflineOperationFailure",B.data)};
OV.prototype.W=function(B){this.api.publish("offlinetransferpause",B.data)};
OV.prototype.eY=function(){var B;(B=this.C)==null||B.close();var M;(M=this.T)==null||M.close()};amx.prototype.By=function(){this.C&&K$(this)};
amx.prototype.aN=function(){this.T&&this.T.resolve();this.B=this.C=!1;this.U()};var prM=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var h6N="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var G$d="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.z(a0o,Pp);a0o.prototype.T=function(B){return vp(B)?qTT(this,B):FY(B)?CAu(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.z(KUt,Pp);KUt.prototype.T=function(B){return FY(B)?eLr(this,B):EsZ(B)?EVu(this,B):bD(B)?vVu(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.e=FUd.prototype;g.e.t34=function(B){var M=this,q,D,O,C;return g.I(function(K){if(!g.X(B.state,128))return K.ZX(0);q=B.state.vF;var E=(D=q)==null?void 0:D.errorCode,v=(O=q)==null?void 0:O.TZ;C=E==="net.connect"&&v===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(E==null?0:E.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.V(K,M.lm(M.player.getVideoData().videoId,C),0)})};
g.e.lm=function(B,M){var q=this;return g.I(function(D){if(D.C==1){if(q.T)return D.return();q.T=!0;return M==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(UV(q,B,!1,!0),D.ZX(0)):g.V(D,Hp(q,B),3)}g.PX(B,4);return g.V(D,q.C.lm(M),0)})};
g.e.Nt=function(B){B.status===2?(B.status!==this.B&&(e2N(this.C),g.PX(B.videoId,2)),B.uq&&bNM(this.C,B.videoId,B.uq)):B.status===4?(Hp(this,B.videoId),this.lm(B.videoId,B.AQ?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):B.status===1&&Fgu(this.C);this.B=B.status;this.api.EC("localmediachange",{videoId:B.videoId,status:B.status})};
g.e.ge=function(){var B=this,M;return g.I(function(q){if(q.C==1){if(B.T)return q.return();B.T=!0;M=B.player.getVideoData().videoId;return g.V(q,Hp(B,M),2)}return g.V(q,B.C.ge(),0)})};
g.e.C4=function(B){switch(B){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.e.G=function(B){return this.api.S().G(B)};g.z($vj,Pp);$vj.prototype.T=function(B){return vp(B)?yoY(this,B):FY(B)?YTM(this,B):EsZ(B)?kFo(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};gVr.prototype.C=function(B,M){var q=B.action.actionMetadata.priority-M.action.actionMetadata.priority;q===0&&(B.C<M.C?q=-1:B.C>M.C&&(q=1));return q};g.z(tu,g.H);tu.prototype.eY=function(){this.U&&this.U();g.H.prototype.eY.call(this)};
tu.prototype.createAction=function(B,M){var q=g.r8(B.entityKey).entityType,D=g.Y9(16);return new zM(q,D,B,M.actionId,M.rootActionId)};
tu.prototype.CR=function(B){var M=this,q,D,O,C,K,E,v,F,b;return g.I(function(u){if(u.C==1){if(M.i5())return u.return();D=(q=B.offlineOrchestrationActionWrapperEntity)!=null?q:new Set;O=[];C=g.h(D);for(K=C.next();!K.done;K=C.next())E=K.value,v=g.r8(E),F=v.entityId,PAH(M.C,F)||O.push(E);return g.V(u,f8t(M,O),2)}b=u.T;return g.V(u,STx(M,b),0)})};
tu.prototype.retry=function(){var B=this;return g.I(function(M){return g.V(M,T6j(B),0)})};Xrt.prototype.HK=function(B,M){M=M===void 0?!0:M;var q=this,D,O,C,K,E,v,F,b;return g.I(function(u){switch(u.C){case 1:if(!q.C)return u.return();D=[];O=g.xK(q.C.T,M);C=[];for(K={x$:0};K.x$<O.length;K={x$:K.x$},K.x$++)E=O[K.x$],v=q.C.b3(E,"json3"),F=g.VO(v,{withCredentials:!0,format:"RAW"},3,500).then(function(J){return function(A){A={metadata:g.NJ(O[J.x$]),trackData:A.xhr.responseText};C.push(A)}}(K)).vg(function(J){DK("Caption fetch error",J)}),D.push(F);
return g.V(u,o2d(D),2);case 2:return g.kZ(u,3),g.V(u,lmM(B,C),5);case 5:g.nZ(u,0);break;case 3:b=g.d0(u),DK("Caption DB transaction error",b),g.YZ(u)}})};g.z(p$,g.H);p$.prototype.eY=function(){this.T&&this.T();g.H.prototype.eY.call(this)};
p$.prototype.B=function(B){var M=this,q,D,O,C,K,E,v,F;return g.I(function(b){D=(q=B.transfer)!=null?q:new Set;O=[];C=g.h(D);for(K=C.next();!K.done;K=C.next())E=K.value,v=g.r8(E),F=v.entityId,O.push(F);return O.length===0?b.return():g.V(b,RLY(M,O),0)})};g.z(Bko,g.H);g.e=Bko.prototype;g.e.eY=function(){this.W8&&this.W8();this.jY.dispose();this.W.dispose();this.Aq&&g.x2(this.K.YF,this.Aq);this.qG&&g.x2(this.K.YF,this.qG);g.H.prototype.eY.call(this)};
g.e.hdX=function(B){var M=this,q,D,O;return g.I(function(C){switch(C.C){case 1:q=g.x6(B,"transfer");if(M.C&&q===M.C.key){UV(M.D,M.J,!0);M.W.stop();C.ZX(0);break}return g.V(C,Re(M.T,{mode:"readwrite",GR:!0},function(K){return cg(K,q,"transfer").then(function(E){if(E&&E.transferState!=="TRANSFER_STATE_COMPLETE"&&E.transferState!=="TRANSFER_STATE_FAILED")return E.transferState="TRANSFER_STATE_PAUSED_BY_USER",Tk(K,E,"transfer").then(function(){return E})})}),3);
case 3:D=C.T;if(!D){C.ZX(0);break}if(!B||!M.B){C.ZX(5);break}return g.V(C,uD(B,M.B,M.T,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.V(C,f$(M,B),7);case 7:O=C.T,e6e({videoId:B,o$:D,offlineModeType:O}),g.YZ(C)}})};
g.e.nDu=function(){var B=this;if(this.C&&this.J){UV(this.D,this.J,!1);var M=this.C,q=(M==null?0:M.key)?g.r8(M.key).entityId:"";q&&this.B&&(new Promise(function(D,O){uD(q,B.B,B.T,"DOWNLOAD_STATE_PAUSED").catch(function(C){O(C)})})).catch(function(D){DK("Download state setting error",D)})}this.W.stop()};
g.e.kH=function(){this.C?DAj(this,this.C):S$(this)};
g.e.jD=function(B){var M=this;return g.I(function(q){switch(q.C){case 1:if(!M.C){q.ZX(2);break}if(M.C.transferState==="TRANSFER_STATE_COMPLETE"||M.C.transferState==="TRANSFER_STATE_FAILED"||!B.transfer||!B.transfer.has(M.C.key)){q.ZX(3);break}return g.V(q,ro(M.T,M.C.key,"transfer"),4);case 4:M.C=q.T;if(M.C){q.ZX(3);break}return g.V(q,ONM(M),3);case 3:if(M.C)return q.return();case 2:return g.V(q,S$(M),0)}})};
g.e.lm=function(B,M){var q=this,D,O,C,K,E;return g.I(function(v){switch(v.C){case 1:if(!q.C){TM(q,"onTransferFailure: "+B);v.ZX(2);break}D=q.C;C=((O=D)==null?0:O.key)?g.r8(D.key).entityId:"";a:switch(B){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var F=!1;break a;default:F=!0}return F&&uRx(q)?g.V(v,L$(q,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.V(v,
J3L(q,B),5);case 5:if(!C||!q.B){v.ZX(2);break}return g.V(v,uD(C,q.B,q.T,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.V(v,f$(q,C),9);case 9:K=v.T;oc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:C,o$:D,offlineModeType:K});if(!C||!q.B){v.ZX(2);break}return g.V(v,uD(C,q.B,q.T,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:cp(q),E=S$(q,!0),M&&M(E),g.YZ(v)}})};
g.e.ge=function(B){var M=this,q,D,O,C,K,E,v,F,b,u,J,A;return g.I(function(N){switch(N.C){case 1:if(!M.C){TM(M,"onMaybeTransferStreamsExpired");N.ZX(2);break}return uRx(M)?g.V(N,L$(M,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.V(N,J3L(M,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!M.B){N.ZX(2);break}q=M.C;O=((D=q)==null?0:D.key)?g.r8(q.key).entityId:"";if(!O){N.ZX(2);break}return g.V(N,uD(O,M.B,M.T,"DOWNLOAD_STATE_FAILED"),2);case 9:return M.C||TM(M,"onMaybeTransferStreamsExpiredRetryAttempting"),
C=M.C,E=((K=C)==null?0:K.key)?g.r8(C.key).entityId:"",g.V(N,f$(M,E),10);case 10:return v=N.T,oc({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:E,o$:C,offlineModeType:v}),F=ukr(),g.pE(F,Wp,{isEnqueuedForExpiredStreamUrlRefetch:!0}),b=g.x6(E,"playbackData"),u={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:b,actionMetadata:F},J=hu(new zM("playbackData",E,u)),g.V(N,iM(M.T,J,"offlineOrchestrationActionWrapperEntity"),2);case 2:cp(M),A=S$(M,!0),
B&&B(A),g.YZ(N)}})};
var $Xj={},A3d=($Xj.TRANSFER_STATE_TRANSFERRING=1,$Xj.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,$Xj);g.e=XY.prototype;g.e.B6=function(){return this.J.promise};
g.e.PP=function(){if(this.T&&this.D)return this.J.promise;$AY(this).then(this.J.resolve).catch(this.J.reject);return this.J.promise};
g.e.qw=function(B){var M={};return M.playbackData=new a0o(B,this.pR,this.C),M.transfer=new $vj(B,this.pR),M.videoPlaybackPositionEntity=new KUt(B,this.pR),M};
g.e.Ni=function(){var B=this;return g.I(function(M){return B.T?g.V(M,MQo(B.T),0):M.ZX(0)})};
g.e.cP=function(){var B=this,M,q;return g.I(function(D){if(D.C==1)return B.T||B.D?g.V(D,B.B6(),2):D.return();B.Y!==void 0&&(g.NX(B.Y),B.Y=void 0);B.W!==void 0&&(g.NX(B.W),B.W=void 0);(M=B.T)==null||M.dispose();B.T=void 0;(q=B.D)==null||q.dispose();B.D=void 0;B.api.EC("onOrchestrationLostLeader");B.J=new g.vc;g.YZ(D)})};
g.e.isOrchestrationLeader=function(){return this.B.C};
g.e.cH=function(){return g.I(function(B){return B.return(!1)})};
g.e.C_=function(B){var M=this.C;M.api.publish("offlinetransferpause",B);var q;(q=M.T)==null||q.postMessage(B)};
g.e.kH=function(B){var M,q;return g.I(function(D){if(D.C==1)return g.V(D,ae(),2);M=D.T;if(!M)return D.return();q=g.x6(B,"transfer");return g.V(D,Re(M,{mode:"readwrite",GR:!0},function(O){var C=cg(O,q,"transfer"),K=cg(O,g.x6(B,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.kI.all([C,K]).then(function(E){E=g.h(E);var v=E.next().value;var F=E.next().value;return v&&v.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(v.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Tk(O,v,"transfer").then(function(){oc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:B,o$:v,offlineModeType:F==null?void 0:F.offlineModeType});return g.kI.resolve(null)})):g.kI.resolve(null)})}),0)})};
g.e.iI=function(B){B=B===void 0?43200:B;var M=this,q,D,O,C,K,E,v,F;return g.I(function(b){if(b.C==1)return M.K.cF()?g.V(b,ae(),2):b.return(h2T());if(b.C!=3){q=b.T;if(!q)return b.return([]);D=Date.now()/1E3;return g.V(b,xw(q,"offlineVideoPolicy"),3)}O=b.T;C=[];K=g.h(O);for(E=K.next();!E.done;E=K.next())v=E.value,Number(v.lastUpdatedTimestampSeconds)+B<=D&&(F=g.r8(v.key).entityId,C.push(F));return C.length?b.return(w3(M,C,M.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):b.return([])})};
g.e.deleteAll=function(){return w3(this,["!*$_ALL_ENTITIES_!*$"],this.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.e.refreshAllStaleEntities=function(B){var M=this;return g.I(function(q){return q.C==1?g.V(q,M.iI(B),2):q.return(q.T)})};
g.e.setUpPositionSyncInterval=function(B){var M=this;this.W!==void 0&&(g.NX(this.W),this.W=void 0);var q=B!=null?B:864E5;this.W=g.Jw(function(){M.DJ(q)},q)};
g.e.DJ=function(B){var M=this,q,D,O,C,K,E;return g.I(function(v){switch(v.C){case 1:return g.kZ(v,2),g.V(v,Uu.getInstance(),4);case 4:q=v.T;if(!q)throw Error("prefStorage is undefined");return g.V(v,q.get("psi"),5);case 5:D=v.T;C=((O=D)==null?0:O.zO)?Number(D.zO)/1E3:0;K=Date.now();if(!(C+B<=K)){v.ZX(6);break}return g.V(v,w3(M,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.nZ(v,0);break;case 2:E=g.d0(v),DK("Offline manager error",E),
g.YZ(v)}})};
g.e.Om=function(){var B=this,M,q,D,O,C,K,E;return g.I(function(v){if(v.C==1)return g.V(v,ae(),2);if(v.C!=3)return(M=v.T)?g.V(v,xw(M,"transfer"),3):v.return([]);q=v.T;D=[];O=g.h(q);for(C=O.next();!C.done;C=O.next())K=C.value,K.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&K.key&&(E=g.r8(K.key).entityId,D.push(E));return v.return(YJu(B,D))})};
g.e.SO=function(){return g.I(function(B){return B.return([])})};
g.e.RB=function(){return g.I(function(B){g.YZ(B)})};
g.e.pJ=function(){return g.I(function(B){g.YZ(B)})};g.z(kWj,Pp);kWj.prototype.T=function(B){return vp(B)?mAT(this,B):FY(B)?VQZ(this,B):bD(B)?gPN(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var sV=[10];g.z(IbY,Pp);IbY.prototype.T=function(B){return vp(B)?HNZ(this,B):FY(B)?UAr(this,B):bD(B)?tQL(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var QFo=[10];g.z(c3r,Pp);c3r.prototype.T=function(B){return FY(B)?fbo(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.z(Tko,XY);g.e=Tko.prototype;g.e.qw=function(B){var M=XY.prototype.qw.call(this,B);M.mainVideoEntity=new IbY(B,this.pR,this.C);M.mainPlaylistEntity=new kWj(B,this.pR,this.C);M.mainDownloadsListEntity=new c3r(B,this.pR,this.C);return M};
g.e.refreshAllStaleEntities=function(B,M){var q=this,D,O,C,K,E,v,F,b,u,J,A;return g.I(function(N){switch(N.C){case 1:D=[];if(!q.pR.G("web_player_offline_playlist_auto_refresh")){N.ZX(2);break}return g.V(N,Lgo(q,B,M),3);case 3:D=N.T;case 2:return g.V(N,Uu.getInstance(),4);case 4:return O=N.T,g.V(N,(C=O)==null?void 0:C.get("sdois"),5);case 5:return K=N.T,g.V(N,(E=O)==null?void 0:E.get("lmqf"),6);case 6:v=N.T;if(!K){N.ZX(7);break}b=D;u=b.concat;return g.V(N,XRT(q,K,(F=v)!=null?F:"SD",B===0),8);case 8:D=
u.call(b,N.T);case 7:return J=D,A=J.concat,g.V(N,XY.prototype.refreshAllStaleEntities.call(q,B,M),9);case 9:return D=A.call(J,N.T),N.return(D)}})};
g.e.cH=function(B){var M,q,D,O,C,K,E,v;return g.I(function(F){if(F.C==1)return g.V(F,ae(),2);if(F.C!=3)return(M=F.T)?g.V(F,ro(M,g.Gi,"mainDownloadsListEntity"),3):F.return(!1);q=F.T;if((D=q)==null?0:(O=D.downloads)==null?0:O.length)for(C=g.x6(B,"mainVideoEntity"),K=g.h(q.downloads),E=K.next();!E.done;E=K.next())if(v=E.value,v.videoItem===C)return F.return(!0);return F.return(!1)})};
g.e.SO=function(){var B=this,M,q,D,O,C,K,E,v;return g.I(function(F){if(F.C==1)return g.V(F,ae(),2);if(F.C!=3)return(M=F.T)?g.V(F,xw(M,"downloadStatusEntity"),3):F.return([]);q=F.T;D=[];O=g.h(q);for(C=O.next();!C.done;C=O.next())K=C.value,K.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&K.key&&(E=g.r8(K.key).entityId,D.push(E));return D.length?(v={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},F.return(w3(B,D,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
v))):F.return([])})};
g.e.pJ=function(){var B;return g.I(function(M){return M.C==1?g.V(M,ae(),2):(B=M.T)?g.V(M,Re(B,{mode:"readwrite",GR:!0},function(q){return SU(q,"mainVideoEntity").then(function(D){var O=[];D=g.h(D);for(var C=D.next();!C.done;C=D.next()){C=C.value;var K=void 0;(K=C.userState)!=null&&K.playbackPosition||(K=g.r8(C.key).entityId,K={key:g.x6(K,"videoPlaybackPositionEntity"),videoId:K,lastPlaybackPositionSeconds:"0"},O.push(Tk(q,K,"videoPlaybackPositionEntity")),C.userState={playbackPosition:K.key},O.push(Tk(q,
C,"mainVideoEntity")))}return g.kI.all(O)})}),0):M.return()})};
g.e.RB=function(){var B,M,q,D,O,C,K,E,v,F,b,u,J,A,N,y,k,m,n,d,W,t,w,L,qO,Dg,x,A_,r,NO,Vr,fZ,mT,bN,g0,mm,Oo,Z;return g.I(function(e1){if(e1.C==1)return g.V(e1,ae(),2);if(e1.C!=3){B=e1.T;if(!B)return e1.return();M=g.x6("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.V(e1,Re(B,{mode:"readonly",GR:!0},function(Rt){return g.kI.all([cg(Rt,M,"mainDownloadsListEntity"),cg(Rt,g.Gi,"mainDownloadsListEntity"),SU(Rt,"mainVideoEntity"),SU(Rt,"mainPlaylistEntity")])}),3)}q=e1.T;
D=g.h(q);O=D.next().value;C=D.next().value;K=D.next().value;E=D.next().value;v=O;F=C;b=K;u=E;J=new Set;if((A=v)==null?0:(N=A.downloads)==null?0:N.length)for(y=g.h(v.downloads),k=y.next();!k.done;k=y.next())m=k.value,n=void 0,(d=(n=m.videoItem)!=null?n:m.playlistItem)&&J.add(d);if((W=F)==null?0:(t=W.downloads)==null?0:t.length)for(w=g.h(F.downloads),L=w.next();!L.done;L=w.next())qO=L.value,qO.videoItem&&J.add(qO.videoItem);Dg=new Set;x=[];A_=g.h(u);for(r=A_.next();!r.done;r=A_.next()){NO=r.value;if(NO.videos)for(Vr=
g.h(NO.videos),fZ=Vr.next();!fZ.done;fZ=Vr.next())mT=fZ.value,(bN=JSON.parse(g.r8(mT).entityId).videoId)&&Dg.add(bN);NO.key&&!J.has(NO.key)&&x.push(NO.key)}g0=g.h(b);for(mm=g0.next();!mm.done;mm=g0.next())Oo=mm.value,Oo.key&&!J.has(Oo.key)&&(Z=g.r8(Oo.key).entityId,Dg.has(Z)||x.push(Oo.key));return x.length?g.V(e1,nsu(B,x),0):e1.ZX(0)})};g.z(wRH,Pp);wRH.prototype.T=function(B){return vp(B)?R2o(this,B):FY(B)?iNN(this,B):bD(B)?r3Z(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var iD=[10];g.z(abT,Pp);abT.prototype.T=function(B){return vp(B)?MNe(this,B):FY(B)?qnL(this,B):bD(B)?DXu(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var r3=[10];g.z(K9x,Pp);K9x.prototype.T=function(B){return vp(B)?vyH(this,B):FY(B)?F9M(this,B):bD(B)?bUM(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var Eyu=[10];g.z(xB,XY);xB.prototype.qw=function(B){var M=XY.prototype.qw.call(this,B);M.musicTrack=new K9x(B,this.C);M.musicPlaylist=new abT(B,this.C);M.musicAlbumRelease=new wRH(B,this.C);return M};
xB.prototype.refreshAllStaleEntities=function(B,M){var q=this,D,O,C;return g.I(function(K){if(K.C==1)return g.V(K,Jwe(q,B,M),2);if(K.C!=3)return O=D=K.T,C=O.concat,g.V(K,XY.prototype.refreshAllStaleEntities.call(q,B,M),3);D=C.call(O,K.T);return K.return(D)})};g.z(AwM,g.v_);g.e=AwM.prototype;g.e.create=function(){var B=this;g.p(this,this.events);g.rY(this.pR)?this.C=new Tko(this.pR,this.player):g.H5(this.pR)&&(this.C=new xB(this.pR,this.player));this.events.V(this.player,"onPlaybackStartExternal",function(){B.lz()});
this.events.V(this.player,"videodatachange",function(){B.lz()});
this.pR.G("html5_offline_playback_position_sync")&&this.events.V(this.player,"presentingplayerstatechange",this.VH)};
g.e.lC=function(){return!1};
g.e.OV=function(B,M,q,D){var O=this;return g.I(function(C){return O.C?C.return(w3(O.C,B,M,q,D)):C.return(Promise.reject())})};
g.e.deleteAll=function(){return this.C.deleteAll()};
g.e.iI=function(B){return this.C.iI(B)};
g.e.refreshAllStaleEntities=function(B){return this.C.refreshAllStaleEntities(B)};
g.e.setUpPositionSyncInterval=function(B){this.C.setUpPositionSyncInterval(B)};
g.e.C_=function(B){this.C.C_(B)};
g.e.kH=function(B){return this.C.kH(B)};
g.e.lz=function(){var B=this,M;return g.I(function(q){M=B.player.getVideoData();return g.s3(M)?Nbu(M)&&B.T!==M.clientPlaybackNonce?g.V(q,zhL(B,M),0):q.ZX(0):q.return()})};
g.e.VH=function(B){var M=this,q,D,O,C,K,E,v;return g.I(function(F){if(F.C==1)return q=M.player.getVideoData(),D=q.OC,g.Jp(B,2)||g.Jp(B,512)?g.V(F,ae(),2):F.return();if(F.C!=3){O=F.T;if(!O)return DK("PES is undefined"),F.return();C=q.videoId;return g.V(F,ro(O,g.x6(C,"mainVideoEntity"),"mainVideoEntity"),3)}K=F.T;if(!K)return F.return();E=Math.floor(D).toString();v={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:E}};return g.V(F,M.OV([C],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
v),0)})};
g.e.isOrchestrationLeader=function(){return this.C.isOrchestrationLeader()};
g.e.updateDownloadState=function(B,M){var q,D,O,C;return g.I(function(K){if(K.C==1)return g.V(K,ae(),2);q=K.T;if(!q)return DK("PES is undefined"),K.return();D=g.r8(B);O=D.entityType;C=D.entityId;return g.V(K,uD(C,O,q,M,!0),0)})};g.Ep("offline",AwM);})(_yt_player);
